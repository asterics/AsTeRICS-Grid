"use strict";(self.webpackChunkasterics_grid=self.webpackChunkasterics_grid||[]).push([[669],{2421:(e,t,r)=>{let n;function i(e){n=e}r.r(t),r.d(t,{Attachment:()=>te,BackupDecryptionKey:()=>ne,BackupKeys:()=>se,BackupSecretsBundle:()=>_e,BaseMigrationData:()=>ce,CancelInfo:()=>ue,CheckCode:()=>le,CollectStrategy:()=>ye,CrossSigningBootstrapRequests:()=>he,CrossSigningKeyExport:()=>fe,CrossSigningStatus:()=>me,Curve25519PublicKey:()=>Se,DecryptedRoomEvent:()=>Ie,DecryptionErrorCode:()=>U,DecryptionSettings:()=>Ce,DehydratedDevice:()=>De,DehydratedDeviceKey:()=>Me,DehydratedDevices:()=>Ae,Device:()=>Ve,DeviceId:()=>Fe,DeviceKey:()=>Pe,DeviceKeyAlgorithm:()=>xe,DeviceKeyAlgorithmName:()=>F,DeviceKeyId:()=>je,DeviceKeyName:()=>T,DeviceLists:()=>We,Ecies:()=>Qe,Ed25519PublicKey:()=>He,Ed25519Signature:()=>Xe,Emoji:()=>Ze,EncryptedAttachment:()=>tt,EncryptionAlgorithm:()=>P,EncryptionInfo:()=>nt,EncryptionSettings:()=>st,EstablishedEcies:()=>_t,EventId:()=>ct,HistoryVisibility:()=>N,IdentityKeys:()=>ut,InboundCreationResult:()=>lt,InboundGroupSession:()=>yt,KeysBackupRequest:()=>ht,KeysClaimRequest:()=>ft,KeysQueryRequest:()=>mt,KeysUploadRequest:()=>St,LocalTrust:()=>x,LoggerLevel:()=>z,MaybeSignature:()=>It,MegolmDecryptionError:()=>Ct,MegolmV1BackupKey:()=>Dt,Migration:()=>Mt,OlmMachine:()=>At,OtherUserIdentity:()=>Vt,OutboundCreationResult:()=>Ft,OwnUserIdentity:()=>Pt,PickledInboundGroupSession:()=>xt,PickledSession:()=>jt,PutDehydratedDeviceRequest:()=>Wt,Qr:()=>Qt,QrCode:()=>Ht,QrCodeData:()=>Xt,QrCodeMode:()=>j,QrCodeScan:()=>Zt,QrState:()=>L,RehydratedDevice:()=>tr,RequestType:()=>W,RoomId:()=>nr,RoomKeyCounts:()=>sr,RoomKeyImportResult:()=>_r,RoomKeyInfo:()=>cr,RoomKeyWithheldInfo:()=>ur,RoomMessageRequest:()=>lr,RoomSettings:()=>yr,Sas:()=>hr,SecretsBundle:()=>fr,ServerName:()=>mr,ShieldColor:()=>G,ShieldState:()=>Sr,ShieldStateCode:()=>Q,Signature:()=>Ir,SignatureState:()=>J,SignatureUploadRequest:()=>Cr,SignatureVerification:()=>Dr,Signatures:()=>Mr,StoreHandle:()=>Ar,ToDeviceRequest:()=>Vr,Tracing:()=>Fr,TrustRequirement:()=>H,UploadSigningKeysRequest:()=>Pr,UserDevices:()=>xr,UserId:()=>jr,VerificationMethod:()=>Y,VerificationRequest:()=>Wr,VerificationRequestPhase:()=>X,Versions:()=>Qr,__wbg_String_8f0eb39a4a4c2f66:()=>Jr,__wbg_String_eecc4a11987127d6:()=>Hr,__wbg_Window_b0044ac7db258535:()=>Yr,__wbg_WorkerGlobalScope_b74cefefc62a37da:()=>Xr,__wbg_add_0d9e99fb9c2d2cc5:()=>$r,__wbg_add_c836e3d4b14cd062:()=>Zr,__wbg_at_479807bfddde3a33:()=>en,__wbg_backupkeys_new:()=>tn,__wbg_bound_1918c0826c5b9363:()=>rn,__wbg_bound_324dfb8899c9798c:()=>nn,__wbg_buffer_61b7ce01341d7f88:()=>sn,__wbg_call_3b770f0d6eb4720e:()=>on,__wbg_call_500db948e69c7330:()=>_n,__wbg_call_9bd6f269d4835e33:()=>an,__wbg_call_b0d8e36992d9900d:()=>cn,__wbg_clearTimeout_5a54f8841c30079a:()=>gn,__wbg_clear_da83758e0bea0eb6:()=>un,__wbg_close_f6e618ed8b0326a3:()=>dn,__wbg_code_71136b86e2aa7f41:()=>ln,__wbg_continue_bd44561c014cacea:()=>pn,__wbg_count_244aa4118e005b59:()=>yn,__wbg_count_4df50ef6c1ddd770:()=>wn,__wbg_createIndex_14571b3c4eec1628:()=>hn,__wbg_createIndex_1d4b2bbb6b21b8f8:()=>bn,__wbg_createObjectStore_b6f14aa10f83a300:()=>fn,__wbg_crosssigningbootstraprequests_new:()=>vn,__wbg_crosssigningkeyexport_new:()=>mn,__wbg_crosssigningstatus_new:()=>kn,__wbg_crypto_ed58b8e10a292839:()=>Sn,__wbg_debug_156ca727dbc3150f:()=>Rn,__wbg_debug_3acd668e6e6c6087:()=>In,__wbg_decryptedroomevent_new:()=>Kn,__wbg_dehydrateddevice_new:()=>Cn,__wbg_dehydrateddevicekey_new:()=>En,__wbg_deleteObjectStore_1f50ba0263875deb:()=>Dn,__wbg_delete_5c33e4966f59624d:()=>On,__wbg_delete_d97b2b4ff716c553:()=>Mn,__wbg_device_new:()=>qn,__wbg_deviceid_new:()=>An,__wbg_devicekey_new:()=>Bn,__wbg_devicekeyid_new:()=>Vn,__wbg_done_f22c1561fa919baa:()=>Un,__wbg_emoji_new:()=>Fn,__wbg_encryptioninfo_new:()=>Tn,__wbg_entries_4f2bb9b0d701c0f6:()=>Pn,__wbg_entries_82bf0e755ef54a5f:()=>Nn,__wbg_error_32fda676ae978f6e:()=>xn,__wbg_error_7534b8e9a36f1ab4:()=>zn,__wbg_error_77233c625ed0c533:()=>jn,__wbg_error_fab41a42d22bf2bc:()=>Ln,__wbg_from_d68eaa96dba25449:()=>Wn,__wbg_getAllKeys_ad97dc28822a6891:()=>Gn,__wbg_getAll_72e2faaa06d1a8cf:()=>Qn,__wbg_getAll_8f38031e5969c7f5:()=>Jn,__wbg_getAll_8fa84589faccab36:()=>Hn,__wbg_getRandomValues_bcb4912f16000dc4:()=>Yn,__wbg_getTime_ab8b72009983c537:()=>Xn,__wbg_get_6a4f854f5cca7403:()=>$n,__wbg_get_7081edc0440983a5:()=>Zn,__wbg_get_9aa3dff3f0266054:()=>ei,__wbg_get_bbccf8970793c087:()=>ti,__wbg_getwithrefkey_1dc361bd10053bfe:()=>ri,__wbg_getwithrefkey_6550b2c093d2eb18:()=>ni,__wbg_global_b6f5c73312f62313:()=>ii,__wbg_inboundgroupsession_new:()=>si,__wbg_index_871d874253bae760:()=>oi,__wbg_indexedDB_601ec26c63e333de:()=>_i,__wbg_indexedDB_72e2ca071222fd9e:()=>ai,__wbg_indexedDB_e34a5e9b3d2fcfa1:()=>ci,__wbg_info_c3044c86ae29faab:()=>gi,__wbg_info_ed71056bef15b91a:()=>ui,__wbg_instanceof_ArrayBuffer_670ddde44cdb2602:()=>di,__wbg_instanceof_Map_98ecb30afec5acdb:()=>li,__wbg_instanceof_Promise_0aa3a90cfe6672c9:()=>pi,__wbg_instanceof_Uint8Array_28af5bc19d6acad8:()=>yi,__wbg_isArray_1ba11a930108ec51:()=>wi,__wbg_isSafeInteger_12f5549b2fca23f4:()=>hi,__wbg_item_7156a8ffa4d816bc:()=>bi,__wbg_iterator_23604bb983791576:()=>fi,__wbg_key_87db8226759da642:()=>vi,__wbg_keysbackuprequest_new:()=>mi,__wbg_keysclaimrequest_new:()=>ki,__wbg_keysqueryrequest_new:()=>Si,__wbg_keysuploadrequest_new:()=>Ri,__wbg_length_65d1cd11729ced11:()=>Ii,__wbg_length_d65cf0786bfc5739:()=>Ki,__wbg_length_f4d79409aa324811:()=>Ci,__wbg_lowerBound_3aa47caa33c7e1e6:()=>Ei,__wbg_maybesignature_new:()=>Di,__wbg_megolmdecryptionerror_new:()=>Oi,__wbg_message_d19bdb65f0a41cf5:()=>Mi,__wbg_msCrypto_0a36e2ec3a343d26:()=>qi,__wbg_name_8862cd49ad807c59:()=>Ai,__wbg_new_0f1bd659dcd47068:()=>Bi,__wbg_new_254fa9eac11932ae:()=>Vi,__wbg_new_3d446df9155128ef:()=>Ui,__wbg_new_3ff5b33b1ce712df:()=>Fi,__wbg_new_41257536af60ed14:()=>Ti,__wbg_new_688846f374351c92:()=>Pi,__wbg_new_8a6f238a6ece86ea:()=>Ni,__wbg_new_9451f3dcb42e0e37:()=>xi,__wbg_new_bc96c6a1c0786643:()=>zi,__wbg_newnoargs_fd9e4bf8be2bc16d:()=>ji,__wbg_newwithbyteoffsetandlength_ba35896968751d91:()=>Li,__wbg_newwithbyteoffsetandlength_c0c90653f73c7dfb:()=>Wi,__wbg_newwithlength_2aede0ef4e6e97ec:()=>Gi,__wbg_newwithlength_34ce8f1051e74449:()=>Qi,__wbg_newwithmessage_80e6436058862fd4:()=>Ji,__wbg_next_01dd9234a5bf6d05:()=>Hi,__wbg_next_137428deb98342b0:()=>Yi,__wbg_node_02999533c4ea02e3:()=>Xi,__wbg_now_2c95c9de01293173:()=>$i,__wbg_now_64d0bb151e5d3889:()=>Zi,__wbg_objectStoreNames_cb00c8113b3cf5df:()=>es,__wbg_objectStore_cdbc73ee600a2cfa:()=>ts,__wbg_oldVersion_a31d9f8577239dd8:()=>rs,__wbg_olmmachine_new:()=>ns,__wbg_openCursor_37e21d9af1a61159:()=>is,__wbg_openCursor_da08cc74542711ad:()=>ss,__wbg_openCursor_e7a3f6453a0f6725:()=>os,__wbg_open_4588c85c0c43671d:()=>_s,__wbg_open_5c51d4d6d7ab6da6:()=>as,__wbg_otheruseridentity_new:()=>cs,__wbg_ownuseridentity_new:()=>gs,__wbg_parse_161c68378e086ae1:()=>us,__wbg_performance_7a3ffd0b17f663ad:()=>ds,__wbg_pickledinboundgroupsession_unwrap:()=>ls,__wbg_pickledsession_unwrap:()=>ps,__wbg_process_5c1d670bc53614b8:()=>ys,__wbg_push_6edad0df4b546b2c:()=>ws,__wbg_put_5393e88dbe742e8f:()=>hs,__wbg_putdehydrateddevicerequest_new:()=>bs,__wbg_qr_new:()=>fs,__wbg_queueMicrotask_2181040e064c0dc8:()=>vs,__wbg_queueMicrotask_ef9ac43769cbcc4f:()=>ms,__wbg_randomFillSync_ab2cfe79ebbf2740:()=>ks,__wbg_readyState_8428fa7c5e093401:()=>Ss,__wbg_rehydrateddevice_new:()=>Rs,__wbg_require_79b1e9274cde3c87:()=>Is,__wbg_resolve_0bf7c44d641804f9:()=>Ks,__wbg_result_e6ba6a347dcb7470:()=>Cs,__wbg_roomid_unwrap:()=>Es,__wbg_roomkeycounts_new:()=>Ds,__wbg_roomkeyimportresult_new:()=>Os,__wbg_roomkeyinfo_new:()=>Ms,__wbg_roomkeywithheldinfo_new:()=>qs,__wbg_roommessagerequest_new:()=>As,__wbg_roomsettings_new:()=>Bs,__wbg_sas_new:()=>Vs,__wbg_secretsbundle_new:()=>Us,__wbg_setTimeout_db2dbaeefb6f39c7:()=>Fs,__wbg_set_1d80752d0d5f0b21:()=>Ts,__wbg_set_23d69db4e5c66a6e:()=>Ps,__wbg_set_3807d5f0bfc24aa7:()=>Ns,__wbg_set_3f1d0b984ed272ed:()=>xs,__wbg_set_76818dc3c59a63d5:()=>zs,__wbg_set_9592f7d5b752cae3:()=>js,__wbg_set_wasm:()=>i,__wbg_setonabort_ade6cac5c35a572f:()=>Ls,__wbg_setonblocked_d13048be9383f4dc:()=>Ws,__wbg_setoncomplete_2747fb71ae0af4a8:()=>Gs,__wbg_setonerror_72b33e31f9edb045:()=>Qs,__wbg_setonerror_e4beb2652cf66635:()=>Js,__wbg_setonsuccess_57167b1c2650357c:()=>Hs,__wbg_setonupgradeneeded_887c7a5fca66011e:()=>Ys,__wbg_setonversionchange_a6f60bd1d110795d:()=>Xs,__wbg_setunique_cfc477dc5825e1c4:()=>$s,__wbg_signatures_new:()=>Zs,__wbg_signatureuploadrequest_new:()=>eo,__wbg_signatureverification_new:()=>to,__wbg_stack_0ed75d68575b0f3c:()=>ro,__wbg_static_accessor_GLOBAL_0be7472e492ad3e3:()=>no,__wbg_static_accessor_GLOBAL_THIS_1a6eb482d12c9bfb:()=>io,__wbg_static_accessor_SELF_1dc398a895c82351:()=>so,__wbg_static_accessor_WINDOW_ae1c80c7eea8d64a:()=>oo,__wbg_storehandle_new:()=>_o,__wbg_stringify_f4f701bc34ceda61:()=>ao,__wbg_subarray_46adeb9b86949d12:()=>co,__wbg_target_a8fe593e7ee79c21:()=>go,__wbg_then_0438fad860fe38e1:()=>uo,__wbg_then_0ffafeddf0e182a4:()=>lo,__wbg_todevicerequest_new:()=>po,__wbg_transaction_bc71c2aaaf467420:()=>yo,__wbg_transaction_d2b6d520837fbe7f:()=>wo,__wbg_transaction_dbab9cd9ea849958:()=>ho,__wbg_update_211ddccaf2cec6ee:()=>bo,__wbg_userdevices_new:()=>fo,__wbg_userid_new:()=>vo,__wbg_userid_unwrap:()=>mo,__wbg_value_0ad6f37677c8ee74:()=>ko,__wbg_value_4c32fd138a88eee2:()=>So,__wbg_values_7aa03dd078978c86:()=>Ro,__wbg_verificationrequest_new:()=>Io,__wbg_version_2b650c9d4f0a2438:()=>Ko,__wbg_versions_c71aa1626a93e0a1:()=>Co,__wbg_warn_123db6aa8948382e:()=>Eo,__wbg_warn_9d038df1589cb1bd:()=>Do,__wbindgen_as_number:()=>Oo,__wbindgen_bigint_from_i64:()=>Mo,__wbindgen_bigint_from_u64:()=>qo,__wbindgen_bigint_get_as_i64:()=>Ao,__wbindgen_boolean_get:()=>Bo,__wbindgen_cb_drop:()=>Vo,__wbindgen_closure_wrapper1050:()=>Uo,__wbindgen_closure_wrapper2213:()=>Fo,__wbindgen_closure_wrapper5386:()=>To,__wbindgen_closure_wrapper6843:()=>Po,__wbindgen_closure_wrapper6848:()=>No,__wbindgen_debug_string:()=>xo,__wbindgen_error_new:()=>zo,__wbindgen_in:()=>jo,__wbindgen_init_externref_table:()=>Lo,__wbindgen_is_array:()=>Wo,__wbindgen_is_bigint:()=>Go,__wbindgen_is_function:()=>Qo,__wbindgen_is_null:()=>Jo,__wbindgen_is_object:()=>Ho,__wbindgen_is_string:()=>Yo,__wbindgen_is_undefined:()=>Xo,__wbindgen_jsval_eq:()=>$o,__wbindgen_jsval_loose_eq:()=>Zo,__wbindgen_memory:()=>e_,__wbindgen_number_get:()=>t_,__wbindgen_number_new:()=>r_,__wbindgen_string_get:()=>n_,__wbindgen_string_new:()=>i_,__wbindgen_throw:()=>s_,__wbindgen_try_into_number:()=>o_,getVersions:()=>D,start:()=>O}),e=r.hmd(e);let s=0,o=null;function _(){return null!==o&&0!==o.byteLength||(o=new Uint8Array(n.memory.buffer)),o}let a=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const c="function"==typeof a.encodeInto?function(e,t){return a.encodeInto(e,t)}:function(e,t){const r=a.encode(e);return t.set(r),{read:e.length,written:r.length}};function g(e,t,r){if(void 0===r){const r=a.encode(e),n=t(r.length,1)>>>0;return _().subarray(n,n+r.length).set(r),s=r.length,n}let n=e.length,i=t(n,1)>>>0;const o=_();let g=0;for(;g<n;g++){const t=e.charCodeAt(g);if(t>127)break;o[i+g]=t}if(g!==n){0!==g&&(e=e.slice(g)),i=r(i,n,n=g+3*e.length,1)>>>0;const t=_().subarray(i+g,i+n);g+=c(e,t).written,i=r(i,n,g,1)>>>0}return s=g,i}let u=null;function d(){return(null===u||!0===u.buffer.detached||void 0===u.buffer.detached&&u.buffer!==n.memory.buffer)&&(u=new DataView(n.memory.buffer)),u}function l(e){const t=n.__externref_table_alloc();return n.__wbindgen_export_4.set(t,e),t}function p(e,t){try{return e.apply(this,t)}catch(e){const t=l(e);n.__wbindgen_exn_store(t)}}let y=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function w(e,t){return e>>>=0,y.decode(_().subarray(e,e+t))}function h(e){return null==e}y.decode();const b="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{n.__wbindgen_export_6.get(e.dtor)(e.a,e.b)}));function f(e,t,r,i){const s={a:e,b:t,cnt:1,dtor:r},o=(...e)=>{s.cnt++;const t=s.a;s.a=0;try{return i(t,s.b,...e)}finally{0==--s.cnt?(n.__wbindgen_export_6.get(s.dtor)(t,s.b),b.unregister(s)):s.a=t}};return o.original=s,b.register(o,s,s),o}function v(e,t,r,i){const s={a:e,b:t,cnt:1,dtor:r},o=(...e)=>{s.cnt++;try{return i(s.a,s.b,...e)}finally{0==--s.cnt&&(n.__wbindgen_export_6.get(s.dtor)(s.a,s.b),s.a=0,b.unregister(s))}};return o.original=s,b.register(o,s,s),o}function m(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=m(e[0]));for(let n=1;n<t;n++)r+=", "+m(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r&&r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function k(e,t){const r=t(1*e.length,1)>>>0;return _().set(e,r/1),s=e.length,r}function S(e){const t=n.__wbindgen_export_4.get(e);return n.__externref_table_dealloc(e),t}function R(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function I(e,t){return e>>>=0,_().subarray(e/1,e/1+t)}function K(e,t){const r=t(4*e.length,4)>>>0,n=d();for(let t=0;t<e.length;t++)n.setUint32(r+4*t,l(e[t]),!0);return s=e.length,r}function C(e,t){e>>>=0;const r=d(),i=[];for(let s=e;s<e+4*t;s+=4)i.push(n.__wbindgen_export_4.get(r.getUint32(s,!0)));return n.__externref_drop_slice(e,t),i}let E=null;function D(){const e=n.getVersions();return Qr.__wrap(e)}function O(){n.start()}function M(e,t,r){const i=n.closure29_externref_shim_multivalue_shim(e,t,r);if(i[1])throw S(i[0])}function q(e,t){n._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__heca5c4426cc7e703(e,t)}function A(e,t,r){n.closure735_externref_shim(e,t,r)}function B(e,t,r){n.closure415_externref_shim(e,t,r)}function V(e,t){n._dyn_core__ops__function__Fn_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h41d552962a79dfb4(e,t)}const U=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt"}),F=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),T=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),P=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),N=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),x=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),z=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),j=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),L=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),W=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),G=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),Q=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation"}),J=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),H=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),Y=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),X=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),$=["pending","done"],Z=["readonly","readwrite","versionchange","readwriteflush","cleanup"],ee="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_attachment_free(e>>>0,1)));class te{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ee.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_attachment_free(e,0)}static encrypt(e){const t=k(e,n.__wbindgen_malloc),r=s,i=n.attachment_encrypt(t,r);if(i[2])throw S(i[1]);return tt.__wrap(i[0])}static decrypt(e){R(e,tt);const t=n.attachment_decrypt(e.__wbg_ptr);if(t[3])throw S(t[2]);var r=I(t[0],t[1]).slice();return n.__wbindgen_free(t[0],1*t[1],1),r}}const re="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupdecryptionkey_free(e>>>0,1)));class ne{static __wrap(e){e>>>=0;const t=Object.create(ne.prototype);return t.__wbg_ptr=e,re.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,re.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=n.backupdecryptionkey_createRandomKey();return ne.__wrap(e)}static fromBase64(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.backupdecryptionkey_fromBase64(t,r);if(i[2])throw S(i[1]);return ne.__wrap(i[0])}toBase64(){return n.backupdecryptionkey_toBase64(this.__wbg_ptr)}get megolmV1PublicKey(){const e=n.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return Dt.__wrap(e)}decryptV1(e,t,r){let i,o;try{const c=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),u=s,d=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),l=s,p=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),y=s,h=n.backupdecryptionkey_decryptV1(this.__wbg_ptr,c,u,d,l,p,y);var _=h[0],a=h[1];if(h[3])throw _=0,a=0,S(h[2]);return i=_,o=a,w(_,a)}finally{n.__wbindgen_free(i,o,1)}}}const ie="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupkeys_free(e>>>0,1)));class se{static __wrap(e){e>>>=0;const t=Object.create(se.prototype);return t.__wbg_ptr=e,ie.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ie.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=n.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return 0===e?void 0:ne.__wrap(e)}set decryptionKey(e){let t=0;h(e)||(R(e,ne),t=e.__destroy_into_raw()),n.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=n.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){return n.backupkeys_decryptionKeyBase64(this.__wbg_ptr)}}const oe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupsecretsbundle_free(e>>>0,1)));class _e{static __wrap(e){e>>>=0;const t=Object.create(_e.prototype);return t.__wbg_ptr=e,oe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set key(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set backup_version(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}}const ae="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_basemigrationdata_free(e>>>0,1)));class ce{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ae.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_basemigrationdata_free(e,0)}get userId(){const e=n.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return 0===e?void 0:jr.__wrap(e)}set userId(e){let t=0;h(e)||(R(e,jr),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=n.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return 0===e?void 0:Fe.__wrap(e)}set deviceId(e){let t=0;h(e)||(R(e,Fe),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=n.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=n.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=n.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupRecoveryKey(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningMasterKey(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningSelfSigningKey(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningUserSigningKey(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=n.basemigrationdata_new();return this.__wbg_ptr=e>>>0,ae.register(this,this.__wbg_ptr,this),this}}const ge="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_cancelinfo_free(e>>>0,1)));class ue{static __wrap(e){e>>>=0;const t=Object.create(ue.prototype);return t.__wbg_ptr=e,ge.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ge.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_cancelinfo_free(e,0)}reason(){return n.cancelinfo_reason(this.__wbg_ptr)}cancelCode(){let e,t;try{const r=n.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}cancelledbyUs(){return 0!==n.cancelinfo_cancelledbyUs(this.__wbg_ptr)}}const de="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_checkcode_free(e>>>0,1)));class le{static __wrap(e){e>>>=0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,de.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,de.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_checkcode_free(e,0)}as_bytes(){const e=n.checkcode_as_bytes(this.__wbg_ptr);var t=I(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}to_digit(){return n.checkcode_to_digit(this.__wbg_ptr)}}const pe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_collectstrategy_free(e>>>0,1)));class ye{static __wrap(e){e>>>=0;const t=Object.create(ye.prototype);return t.__wbg_ptr=e,pe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_collectstrategy_free(e,0)}eq(e){return R(e,ye),0!==n.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr)}static deviceBasedStrategy(e,t){const r=n.collectstrategy_deviceBasedStrategy(e,t);return ye.__wrap(r)}static identityBasedStrategy(){const e=n.collectstrategy_identityBasedStrategy();return ye.__wrap(e)}}const we="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningbootstraprequests_free(e>>>0,1)));class he{static __wrap(e){e>>>=0;const t=Object.create(he.prototype);return t.__wbg_ptr=e,we.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,we.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){return n.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr)}get uploadSigningKeysRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return Pr.__wrap(e)}get uploadSignaturesRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return Cr.__wrap(e)}}const be="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningkeyexport_free(e>>>0,1)));class fe{static __wrap(e){e>>>=0;const t=Object.create(fe.prototype);return t.__wbg_ptr=e,be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,be.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=n.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get self_signing_key(){const e=n.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get userSigningKey(){const e=n.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const ve="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningstatus_free(e>>>0,1)));class me{static __wrap(e){e>>>=0;const t=Object.create(me.prototype);return t.__wbg_ptr=e,ve.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ve.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){return 0!==n.crosssigningstatus_hasMaster(this.__wbg_ptr)}get hasSelfSigning(){return 0!==n.crosssigningstatus_hasSelfSigning(this.__wbg_ptr)}get hasUserSigning(){return 0!==n.crosssigningstatus_hasUserSigning(this.__wbg_ptr)}}const ke="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_curve25519publickey_free(e>>>0,1)));class Se{static __wrap(e){e>>>=0;const t=Object.create(Se.prototype);return t.__wbg_ptr=e,ke.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ke.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.curve25519publickey_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,ke.register(this,this.__wbg_ptr,this),this}get length(){return n.curve25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Re="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_decryptedroomevent_free(e>>>0,1)));class Ie{static __wrap(e){e>>>=0;const t=Object.create(Ie.prototype);return t.__wbg_ptr=e,Re.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Re.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedroomevent_free(e,0)}get event(){return n.__wbg_get_decryptedroomevent_event(this.__wbg_ptr)}get sender(){const e=n.decryptedroomevent_sender(this.__wbg_ptr);return 0===e?void 0:jr.__wrap(e)}get senderDevice(){const e=n.decryptedroomevent_senderDevice(this.__wbg_ptr);return 0===e?void 0:Fe.__wrap(e)}get senderCurve25519Key(){return n.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr)}get senderClaimedEd25519Key(){return n.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr)}get forwardingCurve25519KeyChain(){return n.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr)}shieldState(e){const t=n.decryptedroomevent_shieldState(this.__wbg_ptr,e);return 0===t?void 0:Sr.__wrap(t)}}const Ke="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_decryptionsettings_free(e>>>0,1)));class Ce{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ke.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){return n.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr)}set sender_device_trust_requirement(e){n.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=n.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,Ke.register(this,this.__wbg_ptr,this),this}}const Ee="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevice_free(e>>>0,1)));class De{static __wrap(e){e>>>=0;const t=Object.create(De.prototype);return t.__wbg_ptr=e,Ee.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ee.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){return R(t,Me),n.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr)}}const Oe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevicekey_free(e>>>0,1)));class Me{static __wrap(e){e>>>=0;const t=Object.create(Me.prototype);return t.__wbg_ptr=e,Oe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Oe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=n.dehydrateddevicekey_createRandomKey();if(e[2])throw S(e[1]);return Me.__wrap(e[0])}static createKeyFromArray(e){const t=n.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw S(t[1]);return Me.__wrap(t[0])}toBase64(){return n.dehydrateddevicekey_toBase64(this.__wbg_ptr)}}const qe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevices_free(e>>>0,1)));class Ae{static __wrap(e){e>>>=0;const t=Object.create(Ae.prototype);return t.__wbg_ptr=e,qe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevices_free(e,0)}create(){return n.dehydrateddevices_create(this.__wbg_ptr)}rehydrate(e,t,r){R(e,Me),R(t,Fe);const i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s;return n.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i,o)}getDehydratedDeviceKey(){return n.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr)}saveDehydratedDeviceKey(e){return R(e,Me),n.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr)}deleteDehydratedDeviceKey(){return n.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr)}}const Be="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_device_free(e>>>0,1)));class Ve{static __wrap(e){e>>>=0;const t=Object.create(Ve.prototype);return t.__wbg_ptr=e,Be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Be.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_device_free(e,0)}requestVerification(e){var t=h(e)?0:K(e,n.__wbindgen_malloc),r=s;const i=n.device_requestVerification(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return S(i[0])}encryptToDeviceEvent(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;return n.device_encryptToDeviceEvent(this.__wbg_ptr,r,i,t)}isVerified(){return 0!==n.device_isVerified(this.__wbg_ptr)}isCrossSigningTrusted(){return 0!==n.device_isCrossSigningTrusted(this.__wbg_ptr)}isCrossSignedByOwner(){return 0!==n.device_isCrossSignedByOwner(this.__wbg_ptr)}setLocalTrust(e){return n.device_setLocalTrust(this.__wbg_ptr,e)}get userId(){const e=n.device_userId(this.__wbg_ptr);return jr.__wrap(e)}get deviceId(){const e=n.device_deviceId(this.__wbg_ptr);return Fe.__wrap(e)}get displayName(){const e=n.device_displayName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}getKey(e){const t=n.device_getKey(this.__wbg_ptr,e);if(t[2])throw S(t[1]);return 0===t[0]?void 0:Pe.__wrap(t[0])}get curve25519Key(){const e=n.device_curve25519Key(this.__wbg_ptr);return 0===e?void 0:Se.__wrap(e)}get ed25519Key(){const e=n.device_ed25519Key(this.__wbg_ptr);return 0===e?void 0:He.__wrap(e)}get keys(){return n.device_keys(this.__wbg_ptr)}get algorithms(){return n.device_algorithms(this.__wbg_ptr)}get signatures(){const e=n.device_signatures(this.__wbg_ptr);return Mr.__wrap(e)}get localTrustState(){return n.device_localTrustState(this.__wbg_ptr)}isLocallyTrusted(){return 0!==n.device_isLocallyTrusted(this.__wbg_ptr)}isBlacklisted(){return 0!==n.device_isBlacklisted(this.__wbg_ptr)}isDeleted(){return 0!==n.device_isDeleted(this.__wbg_ptr)}firstTimeSeen(){const e=n.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){return n.device_verify(this.__wbg_ptr)}get isDehydrated(){return 0!==n.device_isDehydrated(this.__wbg_ptr)}}const Ue="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_deviceid_free(e>>>0,1)));class Fe{static __wrap(e){e>>>=0;const t=Object.create(Fe.prototype);return t.__wbg_ptr=e,Ue.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ue.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_deviceid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.deviceid_new(t,r);return this.__wbg_ptr=i>>>0,Ue.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Te="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekey_free(e>>>0,1)));class Pe{static __wrap(e){e>>>=0;const t=Object.create(Pe.prototype);return t.__wbg_ptr=e,Te.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Te.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekey_free(e,0)}get name(){return n.devicekey_name(this.__wbg_ptr)}get curve25519(){const e=n.devicekey_curve25519(this.__wbg_ptr);return 0===e?void 0:Se.__wrap(e)}get ed25519(){const e=n.devicekey_ed25519(this.__wbg_ptr);return 0===e?void 0:He.__wrap(e)}get unknown(){const e=n.devicekey_unknown(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}toBase64(){let e,t;try{const r=n.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Ne="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekeyalgorithm_free(e>>>0,1)));class xe{static __wrap(e){e>>>=0;const t=Object.create(xe.prototype);return t.__wbg_ptr=e,Ne.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ne.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyalgorithm_free(e,0)}get name(){return n.devicekeyalgorithm_name(this.__wbg_ptr)}toString(){let e,t;try{const r=n.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const ze="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekeyid_free(e>>>0,1)));class je{static __wrap(e){e>>>=0;const t=Object.create(je.prototype);return t.__wbg_ptr=e,ze.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ze.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.devicekeyid_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,ze.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=n.devicekeyid_algorithm(this.__wbg_ptr);return xe.__wrap(e)}get deviceId(){const e=n.devicekeyid_deviceId(this.__wbg_ptr);return Fe.__wrap(e)}toString(){let e,t;try{const r=n.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Le="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicelists_free(e>>>0,1)));class We{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Le.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicelists_free(e,0)}constructor(e,t){var r=h(e)?0:K(e,n.__wbindgen_malloc),i=s,o=h(t)?0:K(t,n.__wbindgen_malloc),_=s;const a=n.devicelists_new(r,i,o,_);if(a[2])throw S(a[1]);return this.__wbg_ptr=a[0]>>>0,Le.register(this,this.__wbg_ptr,this),this}isEmpty(){return 0!==n.devicelists_isEmpty(this.__wbg_ptr)}get changed(){const e=n.devicelists_changed(this.__wbg_ptr);var t=C(e[0],e[1]).slice();return n.__wbindgen_free(e[0],4*e[1],4),t}get left(){const e=n.devicelists_left(this.__wbg_ptr);var t=C(e[0],e[1]).slice();return n.__wbindgen_free(e[0],4*e[1],4),t}}const Ge="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ecies_free(e>>>0,1)));class Qe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ge.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ecies_free(e,0)}constructor(){const e=n.ecies_new();return this.__wbg_ptr=e>>>0,Ge.register(this,this.__wbg_ptr,this),this}public_key(){const e=n.ecies_public_key(this.__wbg_ptr);return Se.__wrap(e)}establish_inbound_channel(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return lt.__wrap(i[0])}establish_outbound_channel(e,t){R(e,Se);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=n.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,i);if(o[2])throw S(o[1]);return Ft.__wrap(o[0])}}const Je="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ed25519publickey_free(e>>>0,1)));class He{static __wrap(e){e>>>=0;const t=Object.create(He.prototype);return t.__wbg_ptr=e,Je.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Je.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519publickey_free(e,0)}get length(){return n.ed25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Ye="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ed25519signature_free(e>>>0,1)));class Xe{static __wrap(e){e>>>=0;const t=Object.create(Xe.prototype);return t.__wbg_ptr=e,Ye.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ye.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519signature_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.ed25519signature_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,Ye.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=n.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const $e="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_emoji_free(e>>>0,1)));class Ze{static __wrap(e){e>>>=0;const t=Object.create(Ze.prototype);return t.__wbg_ptr=e,$e.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$e.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_emoji_free(e,0)}get symbol(){return n.emoji_symbol(this.__wbg_ptr)}get description(){return n.emoji_description(this.__wbg_ptr)}}const et="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptedattachment_free(e>>>0,1)));class tt{static __wrap(e){e>>>=0;const t=Object.create(tt.prototype);return t.__wbg_ptr=e,et.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,et.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=k(e,n.__wbindgen_malloc),i=s,o=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s,a=n.encryptedattachment_new(r,i,o,_);if(a[2])throw S(a[1]);return this.__wbg_ptr=a[0]>>>0,et.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=n.encryptedattachment_encryptedData(this.__wbg_ptr);var t=I(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}get mediaEncryptionInfo(){const e=n.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get hasMediaEncryptionInfoBeenConsumed(){return 0!==n.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr)}}const rt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptioninfo_free(e>>>0,1)));class nt{static __wrap(e){e>>>=0;const t=Object.create(nt.prototype);return t.__wbg_ptr=e,rt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,rt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptioninfo_free(e,0)}get sender(){const e=n.encryptioninfo_sender(this.__wbg_ptr);return jr.__wrap(e)}get senderDevice(){const e=n.encryptioninfo_senderDevice(this.__wbg_ptr);return 0===e?void 0:Fe.__wrap(e)}get senderCurve25519Key(){return n.encryptioninfo_senderCurve25519Key(this.__wbg_ptr)}get senderClaimedEd25519Key(){return n.encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr)}shieldState(e){const t=n.encryptioninfo_shieldState(this.__wbg_ptr,e);return Sr.__wrap(t)}}const it="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptionsettings_free(e>>>0,1)));class st{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,it.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptionsettings_free(e,0)}get algorithm(){return n.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get rotationPeriod(){const e=n.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){n.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=n.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){n.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){return n.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr)}set historyVisibility(e){n.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=n.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return ye.__wrap(e)}set sharingStrategy(e){R(e,ye);var t=e.__destroy_into_raw();n.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=n.encryptionsettings_new();return this.__wbg_ptr=e>>>0,it.register(this,this.__wbg_ptr,this),this}}const ot="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_establishedecies_free(e>>>0,1)));class _t{static __wrap(e){e>>>=0;const t=Object.create(_t.prototype);return t.__wbg_ptr=e,ot.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ot.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_establishedecies_free(e,0)}public_key(){const e=n.establishedecies_public_key(this.__wbg_ptr);return Se.__wrap(e)}encrypt(e){let t,r;try{const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s,_=n.establishedecies_encrypt(this.__wbg_ptr,i,o);return t=_[0],r=_[1],w(_[0],_[1])}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const _=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),a=s,c=n.establishedecies_decrypt(this.__wbg_ptr,_,a);var i=c[0],o=c[1];if(c[3])throw i=0,o=0,S(c[2]);return t=i,r=o,w(i,o)}finally{n.__wbindgen_free(t,r,1)}}check_code(){const e=n.establishedecies_check_code(this.__wbg_ptr);return le.__wrap(e)}}const at="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_eventid_free(e>>>0,1)));class ct{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,at.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_eventid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.eventid_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,at.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.eventid_serverName(this.__wbg_ptr);return 0===e?void 0:mr.__wrap(e)}toString(){let e,t;try{const r=n.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const gt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_identitykeys_free(e>>>0,1)));class ut{static __wrap(e){e>>>=0;const t=Object.create(ut.prototype);return t.__wbg_ptr=e,gt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_identitykeys_free(e,0)}get ed25519(){const e=n.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return He.__wrap(e)}set ed25519(e){R(e,He);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=n.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return Se.__wrap(e)}set curve25519(e){R(e,Se);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}}const dt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_inboundcreationresult_free(e>>>0,1)));class lt{static __wrap(e){e>>>=0;const t=Object.create(lt.prototype);return t.__wbg_ptr=e,dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return _t.__wrap(e)}set channel(e){R(e,_t);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=n.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set message(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const pt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_inboundgroupsession_free(e>>>0,1)));class yt{static __wrap(e){e>>>=0;const t=Object.create(yt.prototype);return t.__wbg_ptr=e,pt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=n.inboundgroupsession_roomId(this.__wbg_ptr);return nr.__wrap(e)}get senderKey(){const e=n.inboundgroupsession_senderKey(this.__wbg_ptr);return Se.__wrap(e)}get sessionId(){let e,t;try{const r=n.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}hasBeenImported(){return 0!==n.inboundgroupsession_hasBeenImported(this.__wbg_ptr)}}const wt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysbackuprequest_free(e>>>0,1)));class ht{static __wrap(e){e>>>=0;const t=Object.create(ht.prototype);return t.__wbg_ptr=e,wt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysbackuprequest_free(e,0)}get id(){return n.__wbg_get_keysbackuprequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysbackuprequest_body(this.__wbg_ptr)}get version(){return n.__wbg_get_keysbackuprequest_version(this.__wbg_ptr)}constructor(e,t,r){const i=n.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=i>>>0,wt.register(this,this.__wbg_ptr,this),this}get type(){return n.keysbackuprequest_type(this.__wbg_ptr)}}const bt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysclaimrequest_free(e>>>0,1)));class ft{static __wrap(e){e>>>=0;const t=Object.create(ft.prototype);return t.__wbg_ptr=e,bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysclaimrequest_free(e,0)}get id(){return n.__wbg_get_keysclaimrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysclaimrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,bt.register(this,this.__wbg_ptr,this),this}get type(){return n.keysclaimrequest_type(this.__wbg_ptr)}}const vt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysqueryrequest_free(e>>>0,1)));class mt{static __wrap(e){e>>>=0;const t=Object.create(mt.prototype);return t.__wbg_ptr=e,vt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysqueryrequest_free(e,0)}get id(){return n.__wbg_get_keysqueryrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysqueryrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,vt.register(this,this.__wbg_ptr,this),this}get type(){return n.keysqueryrequest_type(this.__wbg_ptr)}}const kt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysuploadrequest_free(e>>>0,1)));class St{static __wrap(e){e>>>=0;const t=Object.create(St.prototype);return t.__wbg_ptr=e,kt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,kt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysuploadrequest_free(e,0)}get id(){return n.__wbg_get_keysuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,kt.register(this,this.__wbg_ptr,this),this}get type(){return n.keysuploadrequest_type(this.__wbg_ptr)}}const Rt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_maybesignature_free(e>>>0,1)));class It{static __wrap(e){e>>>=0;const t=Object.create(It.prototype);return t.__wbg_ptr=e,Rt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Rt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_maybesignature_free(e,0)}isValid(){return 0!==n.maybesignature_isValid(this.__wbg_ptr)}isInvalid(){return 0!==n.maybesignature_isInvalid(this.__wbg_ptr)}get signature(){const e=n.maybesignature_signature(this.__wbg_ptr);return 0===e?void 0:Ir.__wrap(e)}get invalidSignatureSource(){const e=n.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const Kt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_megolmdecryptionerror_free(e>>>0,1)));class Ct{static __wrap(e){e>>>=0;const t=Object.create(Ct.prototype);return t.__wbg_ptr=e,Kt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Kt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmdecryptionerror_free(e,0)}get code(){return n.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr)}get description(){return n.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr)}get maybe_withheld(){return n.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr)}}const Et="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_megolmv1backupkey_free(e>>>0,1)));class Dt{static __wrap(e){e>>>=0;const t=Object.create(Dt.prototype);return t.__wbg_ptr=e,Et.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Et.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){return n.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr)}get algorithm(){return n.megolmv1backupkey_algorithm(this.__wbg_ptr)}}const Ot="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_migration_free(e>>>0,1)));class Mt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ot.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r){return R(e,ce),R(r,Ar),n.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr)}static migrateOlmSessions(e,t,r){const i=K(e,n.__wbindgen_malloc),o=s;return R(r,Ar),n.migration_migrateOlmSessions(i,o,t,r.__wbg_ptr)}static migrateMegolmSessions(e,t,r){const i=K(e,n.__wbindgen_malloc),o=s;return R(r,Ar),n.migration_migrateMegolmSessions(i,o,t,r.__wbg_ptr)}}const qt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_olmmachine_free(e>>>0,1)));class At{static __wrap(e){e>>>=0;const t=Object.create(At.prototype);return t.__wbg_ptr=e,qt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_olmmachine_free(e,0)}constructor(){const e=n.olmmachine_new();if(e[2])throw S(e[1]);return this.__wbg_ptr=e[0]>>>0,qt.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,i){R(e,jr),R(t,Fe);var o=h(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s,a=h(i)?0:g(i,n.__wbindgen_malloc,n.__wbindgen_realloc),c=s;return n.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,o,_,a,c)}static initFromStore(e,t,r){return R(e,jr),R(t,Fe),R(r,Ar),n.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr)}get userId(){const e=n.olmmachine_userId(this.__wbg_ptr);return jr.__wrap(e)}get deviceId(){const e=n.olmmachine_deviceId(this.__wbg_ptr);return Fe.__wrap(e)}get deviceCreationTimeMs(){return n.olmmachine_deviceCreationTimeMs(this.__wbg_ptr)}get identityKeys(){const e=n.olmmachine_identityKeys(this.__wbg_ptr);return ut.__wrap(e)}get displayName(){return n.olmmachine_displayName(this.__wbg_ptr)}get roomKeyRequestsEnabled(){return 0!==n.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr)}set roomKeyRequestsEnabled(e){n.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){return 0!==n.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr)}set roomKeyForwardingEnabled(e){n.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=n.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}updateTrackedUsers(e){const t=K(e,n.__wbindgen_malloc),r=s;return n.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r)}markAllTrackedUsersAsDirty(){return n.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr)}receiveSyncChanges(e,t,r,i){const o=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s;R(t,We);const a=n.olmmachine_receiveSyncChanges(this.__wbg_ptr,o,_,t.__wbg_ptr,r,h(i)?0:l(i));if(a[2])throw S(a[1]);return S(a[0])}outgoingRequests(){return n.olmmachine_outgoingRequests(this.__wbg_ptr)}markRequestAsSent(e,t,r){const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s,_=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),a=s,c=n.olmmachine_markRequestAsSent(this.__wbg_ptr,i,o,t,_,a);if(c[2])throw S(c[1]);return S(c[0])}encryptRoomEvent(e,t,r){R(e,nr);const i=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s,_=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),a=s,c=n.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,i,o,_,a);if(c[2])throw S(c[1]);return S(c[0])}decryptRoomEvent(e,t,r){const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s;R(t,nr),R(r,Ce);const _=n.olmmachine_decryptRoomEvent(this.__wbg_ptr,i,o,t.__wbg_ptr,r.__wbg_ptr);if(_[2])throw S(_[1]);return S(_[0])}getRoomEventEncryptionInfo(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;R(t,nr);const o=n.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,i,t.__wbg_ptr);if(o[2])throw S(o[1]);return S(o[0])}crossSigningStatus(){return n.olmmachine_crossSigningStatus(this.__wbg_ptr)}exportSecretsBundle(){return n.olmmachine_exportSecretsBundle(this.__wbg_ptr)}importSecretsBundle(e){R(e,fr);var t=e.__destroy_into_raw();return n.olmmachine_importSecretsBundle(this.__wbg_ptr,t)}exportCrossSigningKeys(){return n.olmmachine_exportCrossSigningKeys(this.__wbg_ptr)}importCrossSigningKeys(e,t,r){var i=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s,_=h(t)?0:g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=s,c=h(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),u=s;return n.olmmachine_importCrossSigningKeys(this.__wbg_ptr,i,o,_,a,c,u)}bootstrapCrossSigning(e){return n.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e)}getIdentity(e){return R(e,jr),n.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr)}sign(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;return n.olmmachine_sign(this.__wbg_ptr,t,r)}invalidateGroupSession(e){return R(e,nr),n.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKey(e,t,r){R(e,nr);const i=K(t,n.__wbindgen_malloc),o=s;return R(r,st),n.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,i,o,r.__wbg_ptr)}queryKeysForUsers(e){const t=K(e,n.__wbindgen_malloc),r=s,i=n.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return mt.__wrap(i[0])}getMissingSessions(e){const t=K(e,n.__wbindgen_malloc),r=s;return n.olmmachine_getMissingSessions(this.__wbg_ptr,t,r)}getUserDevices(e,t){return R(e,jr),n.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!h(t),h(t)?0:t)}getDevice(e,t,r){return R(e,jr),R(t,Fe),n.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!h(r),h(r)?0:r)}getVerification(e,t){R(e,jr);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=n.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,i);if(o[2])throw S(o[1]);return S(o[0])}getVerificationRequest(e,t){R(e,jr);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=n.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,i);return 0===o?void 0:Wr.__wrap(o)}getVerificationRequests(e){return R(e,jr),n.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr)}receiveVerificationEvent(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;R(t,nr);const o=n.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,i,t.__wbg_ptr);if(o[2])throw S(o[1]);return S(o[0])}exportRoomKeys(e){return n.olmmachine_exportRoomKeys(this.__wbg_ptr,e)}importRoomKeys(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=n.olmmachine_importRoomKeys(this.__wbg_ptr,r,i,t);if(o[2])throw S(o[1]);return S(o[0])}importExportedRoomKeys(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=n.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,i,t);if(o[2])throw S(o[1]);return S(o[0])}importBackedUpRoomKeys(e,t,r){const i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s,_=n.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,h(t)?0:l(t),i,o);if(_[2])throw S(_[1]);return S(_[0])}saveBackupDecryptionKey(e,t){R(e,ne);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;return n.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,i)}getBackupKeys(){return n.olmmachine_getBackupKeys(this.__wbg_ptr)}verifyBackup(e){const t=n.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw S(t[1]);return S(t[0])}enableBackupV1(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s,a=n.olmmachine_enableBackupV1(this.__wbg_ptr,r,i,o,_);if(a[2])throw S(a[1]);return S(a[0])}isBackupEnabled(){return n.olmmachine_isBackupEnabled(this.__wbg_ptr)}disableBackup(){return n.olmmachine_disableBackup(this.__wbg_ptr)}backupRoomKeys(){return n.olmmachine_backupRoomKeys(this.__wbg_ptr)}roomKeyCounts(){return n.olmmachine_roomKeyCounts(this.__wbg_ptr)}static encryptExportedRoomKeys(e,t,r){let i,o;try{const c=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),u=s,d=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),l=s,p=n.olmmachine_encryptExportedRoomKeys(c,u,d,l,r);var _=p[0],a=p[1];if(p[3])throw _=0,a=0,S(p[2]);return i=_,o=a,w(_,a)}finally{n.__wbindgen_free(i,o,1)}}static decryptExportedRoomKeys(e,t){let r,i;try{const a=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),c=s,u=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),d=s,l=n.olmmachine_decryptExportedRoomKeys(a,c,u,d);var o=l[0],_=l[1];if(l[3])throw o=0,_=0,S(l[2]);return r=o,i=_,w(o,_)}finally{n.__wbindgen_free(r,i,1)}}registerRoomKeyUpdatedCallback(e){return n.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e)}registerRoomKeysWithheldCallback(e){return n.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e)}registerUserIdentityUpdatedCallback(e){return n.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e)}registerDevicesUpdatedCallback(e){return n.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e)}registerReceiveSecretCallback(e){return n.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e)}getSecretsFromInbox(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;return n.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r)}deleteSecretsFromInbox(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;return n.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r)}requestMissingSecretsIfNeeded(){return n.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr)}getRoomSettings(e){return R(e,nr),n.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr)}setRoomSettings(e,t){return R(e,nr),R(t,yr),n.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}dehydratedDevices(){const e=n.olmmachine_dehydratedDevices(this.__wbg_ptr);return Ae.__wrap(e)}close(){const e=this.__destroy_into_raw();n.olmmachine_close(e)}}const Bt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_otheruseridentity_free(e>>>0,1)));class Vt{static __wrap(e){e>>>=0;const t=Object.create(Vt.prototype);return t.__wbg_ptr=e,Bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Bt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_otheruseridentity_free(e,0)}isVerified(){return 0!==n.otheruseridentity_isVerified(this.__wbg_ptr)}verify(){return n.otheruseridentity_verify(this.__wbg_ptr)}requestVerification(e,t,r){R(e,nr),R(t,ct);var i=h(r)?0:K(r,n.__wbindgen_malloc),o=s;const _=n.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i,o);if(_[2])throw S(_[1]);return Wr.__wrap(_[0])}verificationRequestContent(e){let t,r;try{var i=h(e)?0:K(e,n.__wbindgen_malloc),o=s;const c=n.otheruseridentity_verificationRequestContent(this.__wbg_ptr,i,o);var _=c[0],a=c[1];if(c[3])throw _=0,a=0,S(c[2]);return t=_,r=a,w(_,a)}finally{n.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const s=n.otheruseridentity_masterKey(this.__wbg_ptr);var r=s[0],i=s[1];if(s[3])throw r=0,i=0,S(s[2]);return e=r,t=i,w(r,i)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const s=n.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=s[0],i=s[1];if(s[3])throw r=0,i=0,S(s[2]);return e=r,t=i,w(r,i)}finally{n.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){return n.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr)}identityNeedsUserApproval(){return 0!==n.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr)}wasPreviouslyVerified(){return 0!==n.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return n.otheruseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==n.otheruseridentity_hasVerificationViolation(this.__wbg_ptr)}}const Ut="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_outboundcreationresult_free(e>>>0,1)));class Ft{static __wrap(e){e>>>=0;const t=Object.create(Ft.prototype);return t.__wbg_ptr=e,Ut.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ut.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return _t.__wrap(e)}set channel(e){R(e,_t);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=n.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set initial_message(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const Tt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ownuseridentity_free(e>>>0,1)));class Pt{static __wrap(e){e>>>=0;const t=Object.create(Pt.prototype);return t.__wbg_ptr=e,Tt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ownuseridentity_free(e,0)}isVerified(){return 0!==n.ownuseridentity_isVerified(this.__wbg_ptr)}verify(){return n.ownuseridentity_verify(this.__wbg_ptr)}requestVerification(e){var t=h(e)?0:K(e,n.__wbindgen_malloc),r=s;const i=n.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return S(i[0])}trustsOurOwnDevice(){return n.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr)}get masterKey(){let e,t;try{const s=n.ownuseridentity_masterKey(this.__wbg_ptr);var r=s[0],i=s[1];if(s[3])throw r=0,i=0,S(s[2]);return e=r,t=i,w(r,i)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const s=n.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=s[0],i=s[1];if(s[3])throw r=0,i=0,S(s[2]);return e=r,t=i,w(r,i)}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const s=n.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=s[0],i=s[1];if(s[3])throw r=0,i=0,S(s[2]);return e=r,t=i,w(r,i)}finally{n.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){return 0!==n.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return n.ownuseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==n.ownuseridentity_hasVerificationViolation(this.__wbg_ptr)}}const Nt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_pickledinboundgroupsession_free(e>>>0,1)));class xt{static __unwrap(e){return e instanceof xt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=n.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set senderSigningKey(e){var t=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=n.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return 0===e?void 0:nr.__wrap(e)}set roomId(e){let t=0;h(e)||(R(e,nr),t=e.__destroy_into_raw()),n.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){return 0!==n.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr)}set imported(e){n.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){return 0!==n.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr)}set backedUp(e){n.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=n.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,Nt.register(this,this.__wbg_ptr,this),this}}const zt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_pickledsession_free(e>>>0,1)));class jt{static __unwrap(e){return e instanceof jt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,zt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){return 0!==n.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr)}set createdUsingFallbackKey(e){n.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){return n.__wbg_get_pickledsession_creationTime(this.__wbg_ptr)}set creationTime(e){n.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){return n.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr)}set lastUseTime(e){n.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=n.pickledsession_new();return this.__wbg_ptr=e>>>0,zt.register(this,this.__wbg_ptr,this),this}}const Lt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_putdehydrateddevicerequest_free(e>>>0,1)));class Wt{static __wrap(e){e>>>=0;const t=Object.create(Wt.prototype);return t.__wbg_ptr=e,Lt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){return n.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr)}constructor(e){const t=n.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,Lt.register(this,this.__wbg_ptr,this),this}}const Gt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qr_free(e>>>0,1)));class Qt{static __wrap(e){e>>>=0;const t=Object.create(Qt.prototype);return t.__wbg_ptr=e,Gt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qr_free(e,0)}state(){return n.qr_state(this.__wbg_ptr)}hasBeenScanned(){return 0!==n.qr_hasBeenScanned(this.__wbg_ptr)}hasBeenConfirmed(){return 0!==n.qr_hasBeenConfirmed(this.__wbg_ptr)}get userId(){const e=n.qr_userId(this.__wbg_ptr);return jr.__wrap(e)}get otherUserId(){const e=n.qr_otherUserId(this.__wbg_ptr);return jr.__wrap(e)}get otherDeviceId(){const e=n.qr_otherDeviceId(this.__wbg_ptr);return Fe.__wrap(e)}weStarted(){return 0!==n.qr_weStarted(this.__wbg_ptr)}cancelInfo(){const e=n.qr_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ue.__wrap(e)}isDone(){return 0!==n.qr_isDone(this.__wbg_ptr)}isCancelled(){return 0!==n.qr_isCancelled(this.__wbg_ptr)}isSelfVerification(){return 0!==n.qr_isSelfVerification(this.__wbg_ptr)}reciprocated(){return 0!==n.qr_reciprocated(this.__wbg_ptr)}get flowId(){let e,t;try{const r=n.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.qr_roomId(this.__wbg_ptr);return 0===e?void 0:nr.__wrap(e)}toQrCode(){const e=n.qr_toQrCode(this.__wbg_ptr);if(e[2])throw S(e[1]);return Ht.__wrap(e[0])}toBytes(){const e=n.qr_toBytes(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}reciprocate(){const e=n.qr_reciprocate(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}confirmScanning(){const e=n.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}cancel(){const e=n.qr_cancel(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}cancelWithCode(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.qr_cancelWithCode(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return S(i[0])}registerChangesCallback(e){n.qr_registerChangesCallback(this.__wbg_ptr,e)}}const Jt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcode_free(e>>>0,1)));class Ht{static __wrap(e){e>>>=0;const t=Object.create(Ht.prototype);return t.__wbg_ptr=e,Jt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=n.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}}const Yt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcodedata_free(e>>>0,1)));class Xt{static __wrap(e){e>>>=0;const t=Object.create(Xt.prototype);return t.__wbg_ptr=e,Yt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Yt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){R(e,Se);var i=e.__destroy_into_raw();const o=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s;var a=h(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=s;const u=n.qrcodedata_new(i,o,_,a,c);if(u[2])throw S(u[1]);return this.__wbg_ptr=u[0]>>>0,Yt.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=k(e,n.__wbindgen_malloc),r=s,i=n.qrcodedata_fromBytes(t,r);if(i[2])throw S(i[1]);return Xt.__wrap(i[0])}toBytes(){const e=n.qrcodedata_toBytes(this.__wbg_ptr);var t=I(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}static fromBase64(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.qrcodedata_fromBase64(t,r);if(i[2])throw S(i[1]);return Xt.__wrap(i[0])}toBase64(){let e,t;try{const r=n.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get publicKey(){const e=n.qrcodedata_publicKey(this.__wbg_ptr);return Se.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=n.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.qrcodedata_serverName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get mode(){return n.qrcodedata_mode(this.__wbg_ptr)}}const $t="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcodescan_free(e>>>0,1)));class Zt{static __wrap(e){e>>>=0;const t=Object.create(Zt.prototype);return t.__wbg_ptr=e,$t.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$t.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=n.qrcodescan_fromBytes(e);if(t[2])throw S(t[1]);return Zt.__wrap(t[0])}}const er="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_rehydrateddevice_free(e>>>0,1)));class tr{static __wrap(e){e>>>=0;const t=Object.create(tr.prototype);return t.__wbg_ptr=e,er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,er.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s;return n.rehydrateddevice_receiveEvents(this.__wbg_ptr,t,r)}}const rr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomid_free(e>>>0,1)));class nr{static __wrap(e){e>>>=0;const t=Object.create(nr.prototype);return t.__wbg_ptr=e,rr.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof nr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,rr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.roomid_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,rr.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const ir="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeycounts_free(e>>>0,1)));class sr{static __wrap(e){e>>>=0;const t=Object.create(sr.prototype);return t.__wbg_ptr=e,ir.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ir.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeycounts_free(e,0)}get total(){return n.__wbg_get_roomkeycounts_total(this.__wbg_ptr)}set total(e){n.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){return n.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr)}set backedUp(e){n.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}}const or="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeyimportresult_free(e>>>0,1)));class _r{static __wrap(e){e>>>=0;const t=Object.create(_r.prototype);return t.__wbg_ptr=e,or.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,or.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){return n.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr)>>>0}get totalCount(){return n.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr)>>>0}keys(){return n.roomkeyimportresult_keys(this.__wbg_ptr)}}const ar="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeyinfo_free(e>>>0,1)));class cr{static __wrap(e){e>>>=0;const t=Object.create(cr.prototype);return t.__wbg_ptr=e,ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ar.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyinfo_free(e,0)}get algorithm(){return n.roomkeyinfo_algorithm(this.__wbg_ptr)}get roomId(){const e=n.roomkeyinfo_roomId(this.__wbg_ptr);return nr.__wrap(e)}get senderKey(){const e=n.roomkeyinfo_senderKey(this.__wbg_ptr);return Se.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const gr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeywithheldinfo_free(e>>>0,1)));class ur{static __wrap(e){e>>>=0;const t=Object.create(ur.prototype);return t.__wbg_ptr=e,gr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=n.roomkeywithheldinfo_sender(this.__wbg_ptr);return jr.__wrap(e)}get algorithm(){return n.roomkeywithheldinfo_algorithm(this.__wbg_ptr)}get withheldCode(){let e,t;try{const r=n.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.roomkeywithheldinfo_roomId(this.__wbg_ptr);return nr.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const dr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roommessagerequest_free(e>>>0,1)));class lr{static __wrap(e){e>>>=0;const t=Object.create(lr.prototype);return t.__wbg_ptr=e,dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roommessagerequest_free(e,0)}get id(){return n.__wbg_get_roommessagerequest_id(this.__wbg_ptr)}get room_id(){return n.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr)}get body(){return n.__wbg_get_roommessagerequest_body(this.__wbg_ptr)}constructor(e,t,r,i,s){const o=n.roommessagerequest_new(e,t,r,i,s);return this.__wbg_ptr=o>>>0,dr.register(this,this.__wbg_ptr,this),this}get type(){return n.roommessagerequest_type(this.__wbg_ptr)}}const pr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomsettings_free(e>>>0,1)));class yr{static __wrap(e){e>>>=0;const t=Object.create(yr.prototype);return t.__wbg_ptr=e,pr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomsettings_free(e,0)}get algorithm(){return n.__wbg_get_roomsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){return 0!==n.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr)}set onlyAllowTrustedDevices(e){n.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMs(e){n.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!h(e),h(e)?0:e)}get sessionRotationPeriodMessages(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMessages(e){n.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!h(e),h(e)?0:e)}constructor(){const e=n.roomsettings_new();return this.__wbg_ptr=e>>>0,pr.register(this,this.__wbg_ptr,this),this}}const wr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_sas_free(e>>>0,1)));class hr{static __wrap(e){e>>>=0;const t=Object.create(hr.prototype);return t.__wbg_ptr=e,wr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_sas_free(e,0)}get userId(){const e=n.sas_userId(this.__wbg_ptr);return jr.__wrap(e)}get deviceId(){const e=n.sas_deviceId(this.__wbg_ptr);return Fe.__wrap(e)}get otherUserId(){const e=n.sas_otherUserId(this.__wbg_ptr);return jr.__wrap(e)}get otherDeviceId(){const e=n.sas_otherDeviceId(this.__wbg_ptr);return Fe.__wrap(e)}get flowId(){let e,t;try{const r=n.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.sas_roomId(this.__wbg_ptr);return 0===e?void 0:nr.__wrap(e)}supportsEmoji(){return 0!==n.sas_supportsEmoji(this.__wbg_ptr)}startedFromRequest(){return 0!==n.sas_startedFromRequest(this.__wbg_ptr)}isSelfVerification(){return 0!==n.sas_isSelfVerification(this.__wbg_ptr)}haveWeConfirmed(){return 0!==n.sas_haveWeConfirmed(this.__wbg_ptr)}hasBeenAccepted(){return 0!==n.sas_hasBeenAccepted(this.__wbg_ptr)}cancelInfo(){const e=n.sas_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ue.__wrap(e)}weStarted(){return 0!==n.sas_weStarted(this.__wbg_ptr)}accept(){const e=n.sas_accept(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}confirm(){return n.sas_confirm(this.__wbg_ptr)}cancel(){const e=n.sas_cancel(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}cancelWithCode(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.sas_cancelWithCode(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return S(i[0])}timedOut(){return 0!==n.sas_timedOut(this.__wbg_ptr)}canBePresented(){return 0!==n.sas_canBePresented(this.__wbg_ptr)}isDone(){return 0!==n.sas_isDone(this.__wbg_ptr)}isCancelled(){return 0!==n.sas_isCancelled(this.__wbg_ptr)}emoji(){const e=n.sas_emoji(this.__wbg_ptr);let t;return 0!==e[0]&&(t=C(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}emojiIndex(){const e=n.sas_emojiIndex(this.__wbg_ptr);let t;return 0!==e[0]&&(t=I(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}decimals(){const e=n.sas_decimals(this.__wbg_ptr);let t;return 0!==e[0]&&(t=(r=e[0],i=e[1],r>>>=0,(null!==E&&0!==E.byteLength||(E=new Uint16Array(n.memory.buffer)),E).subarray(r/2,r/2+i)).slice(),n.__wbindgen_free(e[0],2*e[1],2)),t;var r,i}registerChangesCallback(e){n.sas_registerChangesCallback(this.__wbg_ptr,e)}}const br="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_secretsbundle_free(e>>>0,1)));class fr{static __wrap(e){e>>>=0;const t=Object.create(fr.prototype);return t.__wbg_ptr=e,br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,br.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=n.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=n.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=n.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get backupBundle(){const e=n.secretsbundle_backupBundle(this.__wbg_ptr);return 0===e?void 0:_e.__wrap(e)}to_json(){const e=n.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}static from_json(e){const t=n.secretsbundle_from_json(e);if(t[2])throw S(t[1]);return fr.__wrap(t[0])}}const vr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_servername_free(e>>>0,1)));class mr{static __wrap(e){e>>>=0;const t=Object.create(mr.prototype);return t.__wbg_ptr=e,vr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_servername_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.servername_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,vr.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=n.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get port(){const e=n.servername_port(this.__wbg_ptr);return 16777215===e?void 0:e}isIpLiteral(){return 0!==n.servername_isIpLiteral(this.__wbg_ptr)}}const kr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_shieldstate_free(e>>>0,1)));class Sr{static __wrap(e){e>>>=0;const t=Object.create(Sr.prototype);return t.__wbg_ptr=e,kr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,kr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_shieldstate_free(e,0)}get color(){return n.__wbg_get_shieldstate_color(this.__wbg_ptr)}set color(e){n.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=n.__wbg_get_shieldstate_code(this.__wbg_ptr);return 6===e?void 0:e}set code(e){n.__wbg_set_shieldstate_code(this.__wbg_ptr,h(e)?6:e)}get message(){const e=n.shieldstate_message(this.__wbg_ptr);let t;return 0!==e[0]&&(t=w(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const Rr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signature_free(e>>>0,1)));class Ir{static __wrap(e){e>>>=0;const t=Object.create(Ir.prototype);return t.__wbg_ptr=e,Rr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Rr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signature_free(e,0)}get ed25519(){const e=n.signature_ed25519(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}toBase64(){let e,t;try{const r=n.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Kr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatureuploadrequest_free(e>>>0,1)));class Cr{static __wrap(e){e>>>=0;const t=Object.create(Cr.prototype);return t.__wbg_ptr=e,Kr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Kr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureuploadrequest_free(e,0)}get id(){return n.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Kr.register(this,this.__wbg_ptr,this),this}get type(){return n.signatureuploadrequest_type(this.__wbg_ptr)}}const Er="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatureverification_free(e>>>0,1)));class Dr{static __wrap(e){e>>>=0;const t=Object.create(Dr.prototype);return t.__wbg_ptr=e,Er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Er.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureverification_free(e,0)}get deviceState(){return n.signatureverification_deviceState(this.__wbg_ptr)}get userState(){return n.signatureverification_userState(this.__wbg_ptr)}trusted(){return 0!==n.signatureverification_trusted(this.__wbg_ptr)}}const Or="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatures_free(e>>>0,1)));class Mr{static __wrap(e){e>>>=0;const t=Object.create(Mr.prototype);return t.__wbg_ptr=e,Or.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Or.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatures_free(e,0)}constructor(){const e=n.signatures_new();return this.__wbg_ptr=e>>>0,Or.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){R(e,jr),R(t,je),R(r,Xe);const i=n.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return 0===i?void 0:It.__wrap(i)}getSignature(e,t){R(e,jr),R(t,je);const r=n.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return 0===r?void 0:Xe.__wrap(r)}get(e){return R(e,jr),n.signatures_get(this.__wbg_ptr,e.__wbg_ptr)}clear(){n.signatures_clear(this.__wbg_ptr)}isEmpty(){return 0!==n.signatures_isEmpty(this.__wbg_ptr)}get count(){return n.signatures_count(this.__wbg_ptr)>>>0}asJSON(){const e=n.signatures_asJSON(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}}const qr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_storehandle_free(e>>>0,1)));class Ar{static __wrap(e){e>>>=0;const t=Object.create(Ar.prototype);return t.__wbg_ptr=e,qr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storehandle_free(e,0)}static open(e,t){var r=h(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=h(t)?0:g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s;return n.storehandle_open(r,i,o,_)}static openWithKey(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s,o=k(t,n.__wbindgen_malloc),_=s;return n.storehandle_openWithKey(r,i,o,_)}}const Br="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_todevicerequest_free(e>>>0,1)));class Vr{static __wrap(e){e>>>=0;const t=Object.create(Vr.prototype);return t.__wbg_ptr=e,Br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Br.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todevicerequest_free(e,0)}get id(){return n.__wbg_get_todevicerequest_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_todevicerequest_event_type(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr)}get body(){return n.__wbg_get_todevicerequest_body(this.__wbg_ptr)}constructor(e,t,r,i){const s=n.todevicerequest_new(e,t,r,i);return this.__wbg_ptr=s>>>0,Br.register(this,this.__wbg_ptr,this),this}get type(){return n.todevicerequest_type(this.__wbg_ptr)}}const Ur="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_tracing_free(e>>>0,1)));class Fr{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ur.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_tracing_free(e,0)}static isAvailable(){return 0!==n.tracing_isAvailable()}constructor(e){const t=n.tracing_new(e);if(t[2])throw S(t[1]);return this.__wbg_ptr=t[0]>>>0,Ur.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=n.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw S(t[0])}turnOn(){const e=n.tracing_turnOn(this.__wbg_ptr);if(e[1])throw S(e[0])}turnOff(){const e=n.tracing_turnOff(this.__wbg_ptr);if(e[1])throw S(e[0])}}const Tr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_uploadsigningkeysrequest_free(e>>>0,1)));class Pr{static __wrap(e){e>>>=0;const t=Object.create(Pr.prototype);return t.__wbg_ptr=e,Tr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){return n.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr)}constructor(e){const t=n.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,Tr.register(this,this.__wbg_ptr,this),this}}const Nr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_userdevices_free(e>>>0,1)));class xr{static __wrap(e){e>>>=0;const t=Object.create(xr.prototype);return t.__wbg_ptr=e,Nr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userdevices_free(e,0)}get(e){R(e,Fe);const t=n.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return 0===t?void 0:Ve.__wrap(t)}isAnyVerified(){return 0!==n.userdevices_isAnyVerified(this.__wbg_ptr)}keys(){return n.userdevices_keys(this.__wbg_ptr)}devices(){return n.userdevices_devices(this.__wbg_ptr)}}const zr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_userid_free(e>>>0,1)));class jr{static __wrap(e){e>>>=0;const t=Object.create(jr.prototype);return t.__wbg_ptr=e,zr.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof jr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,zr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=s,i=n.userid_new(t,r);if(i[2])throw S(i[1]);return this.__wbg_ptr=i[0]>>>0,zr.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.userid_serverName(this.__wbg_ptr);return mr.__wrap(e)}isHistorical(){return 0!==n.userid_isHistorical(this.__wbg_ptr)}toString(){let e,t;try{const r=n.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}clone(){const e=n.userid_clone(this.__wbg_ptr);return jr.__wrap(e)}}const Lr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_verificationrequest_free(e>>>0,1)));class Wr{static __wrap(e){e>>>=0;const t=Object.create(Wr.prototype);return t.__wbg_ptr=e,Lr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_verificationrequest_free(e,0)}static request(e,t,r,i){let o,_;try{R(e,jr),R(t,Fe),R(r,jr);var a=h(i)?0:K(i,n.__wbindgen_malloc),c=s;const d=n.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,a,c);var g=d[0],u=d[1];if(d[3])throw g=0,u=0,S(d[2]);return o=g,_=u,w(g,u)}finally{n.__wbindgen_free(o,_,1)}}get ownUserId(){const e=n.verificationrequest_ownUserId(this.__wbg_ptr);return jr.__wrap(e)}get otherUserId(){const e=n.verificationrequest_otherUserId(this.__wbg_ptr);return jr.__wrap(e)}get otherDeviceId(){const e=n.verificationrequest_otherDeviceId(this.__wbg_ptr);return 0===e?void 0:Fe.__wrap(e)}get roomId(){const e=n.verificationrequest_roomId(this.__wbg_ptr);return 0===e?void 0:nr.__wrap(e)}get cancelInfo(){const e=n.verificationrequest_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ue.__wrap(e)}isPassive(){return 0!==n.verificationrequest_isPassive(this.__wbg_ptr)}isReady(){return 0!==n.verificationrequest_isReady(this.__wbg_ptr)}timedOut(){return 0!==n.verificationrequest_timedOut(this.__wbg_ptr)}timeRemainingMillis(){return n.verificationrequest_timeRemainingMillis(this.__wbg_ptr)}get theirSupportedMethods(){const e=n.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw S(e[2]);let t;return 0!==e[0]&&(t=C(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}get ourSupportedMethods(){const e=n.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw S(e[2]);let t;return 0!==e[0]&&(t=C(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}get flowId(){let e,t;try{const r=n.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],w(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}isSelfVerification(){return 0!==n.verificationrequest_isSelfVerification(this.__wbg_ptr)}weStarted(){return 0!==n.verificationrequest_weStarted(this.__wbg_ptr)}isDone(){return 0!==n.verificationrequest_isDone(this.__wbg_ptr)}phase(){return n.verificationrequest_phase(this.__wbg_ptr)}getVerification(){return n.verificationrequest_getVerification(this.__wbg_ptr)}registerChangesCallback(e){n.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){return 0!==n.verificationrequest_isCancelled(this.__wbg_ptr)}acceptWithMethods(e){const t=K(e,n.__wbindgen_malloc),r=s,i=n.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(i[2])throw S(i[1]);return S(i[0])}accept(){const e=n.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}cancel(){const e=n.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw S(e[1]);return S(e[0])}startSas(){return n.verificationrequest_startSas(this.__wbg_ptr)}generateQrCode(){return n.verificationrequest_generateQrCode(this.__wbg_ptr)}scanQrCode(e){return R(e,Zt),n.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr)}}const Gr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_versions_free(e>>>0,1)));class Qr{static __wrap(e){e>>>=0;const t=Object.create(Qr.prototype);return t.__wbg_ptr=e,Gr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_versions_free(e,0)}get vodozemac(){return n.__wbg_get_versions_vodozemac(this.__wbg_ptr)}get matrix_sdk_crypto(){return n.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr)}get git_sha(){return n.__wbg_get_versions_git_sha(this.__wbg_ptr)}get git_description(){return n.__wbg_get_versions_git_description(this.__wbg_ptr)}}function Jr(e,t){const r=g(String(t),n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function Hr(e,t){const r=g(String(t),n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function Yr(e){return e.Window}function Xr(e){return e.WorkerGlobalScope}function $r(e,t){return e.add(t)}function Zr(){return p((function(e,t,r){return e.add(t,r)}),arguments)}function en(e,t){return e.at(t)}function tn(e){return se.__wrap(e)}function rn(){return p((function(e,t,r,n){return IDBKeyRange.bound(e,t,0!==r,0!==n)}),arguments)}function nn(){return p((function(e,t){return IDBKeyRange.bound(e,t)}),arguments)}function sn(e){return e.buffer}function on(){return p((function(e,t,r,n){return e.call(t,r,n)}),arguments)}function _n(){return p((function(e,t,r){return e.call(t,r)}),arguments)}function an(){return p((function(e,t,r,n,i){return e.call(t,r,n,i)}),arguments)}function cn(){return p((function(e,t){return e.call(t)}),arguments)}function gn(e){return clearTimeout(e)}function un(){return p((function(e){return e.clear()}),arguments)}function dn(e){e.close()}function ln(e){return e.code}function pn(){return p((function(e){e.continue()}),arguments)}function yn(){return p((function(e){return e.count()}),arguments)}function wn(){return p((function(e){return e.count()}),arguments)}function hn(){return p((function(e,t,r,n){return e.createIndex(w(t,r),n)}),arguments)}function bn(){return p((function(e,t,r,n,i){return e.createIndex(w(t,r),n,i)}),arguments)}function fn(){return p((function(e,t,r){return e.createObjectStore(w(t,r))}),arguments)}function vn(e){return he.__wrap(e)}function mn(e){return fe.__wrap(e)}function kn(e){return me.__wrap(e)}function Sn(e){return e.crypto}function Rn(e){console.debug(e)}function In(e,t){e.debug(t)}function Kn(e){return Ie.__wrap(e)}function Cn(e){return De.__wrap(e)}function En(e){return Me.__wrap(e)}function Dn(){return p((function(e,t,r){e.deleteObjectStore(w(t,r))}),arguments)}function On(){return p((function(e,t){return e.delete(t)}),arguments)}function Mn(){return p((function(e){return e.delete()}),arguments)}function qn(e){return Ve.__wrap(e)}function An(e){return Fe.__wrap(e)}function Bn(e){return Pe.__wrap(e)}function Vn(e){return je.__wrap(e)}function Un(e){return e.done}function Fn(e){return Ze.__wrap(e)}function Tn(e){return nt.__wrap(e)}function Pn(e){return Object.entries(e)}function Nn(e){return e.entries()}function xn(e,t){e.error(t)}function zn(e,t){let r,i;try{r=e,i=t,console.error(w(e,t))}finally{n.__wbindgen_free(r,i,1)}}function jn(){return p((function(e){const t=e.error;return h(t)?0:l(t)}),arguments)}function Ln(e){console.error(e)}function Wn(e){return Array.from(e)}function Gn(){return p((function(e){return e.getAllKeys()}),arguments)}function Qn(){return p((function(e){return e.getAll()}),arguments)}function Jn(){return p((function(e,t){return e.getAll(t)}),arguments)}function Hn(){return p((function(e,t,r){return e.getAll(t,r>>>0)}),arguments)}function Yn(){return p((function(e,t){e.getRandomValues(t)}),arguments)}function Xn(e){return e.getTime()}function $n(){return p((function(e,t){return e.get(t)}),arguments)}function Zn(){return p((function(e,t){return e.get(t)}),arguments)}function ei(e,t){return e[t>>>0]}function ti(){return p((function(e,t){return Reflect.get(e,t)}),arguments)}function ri(e,t){return e[t]}function ni(e,t){return e[t]}function ii(e){return e.global}function si(e){return yt.__wrap(e)}function oi(){return p((function(e,t,r){return e.index(w(t,r))}),arguments)}function _i(){return p((function(e){const t=e.indexedDB;return h(t)?0:l(t)}),arguments)}function ai(){return p((function(e){const t=e.indexedDB;return h(t)?0:l(t)}),arguments)}function ci(){return p((function(e){const t=e.indexedDB;return h(t)?0:l(t)}),arguments)}function gi(e){console.info(e)}function ui(e,t){e.info(t)}function di(e){let t;try{t=e instanceof ArrayBuffer}catch(e){t=!1}return t}function li(e){let t;try{t=e instanceof Map}catch(e){t=!1}return t}function pi(e){let t;try{t=e instanceof Promise}catch(e){t=!1}return t}function yi(e){let t;try{t=e instanceof Uint8Array}catch(e){t=!1}return t}function wi(e){return Array.isArray(e)}function hi(e){return Number.isSafeInteger(e)}function bi(e,t,r){const i=t.item(r>>>0);var o=h(i)?0:g(i,n.__wbindgen_malloc,n.__wbindgen_realloc),_=s;d().setInt32(e+4,_,!0),d().setInt32(e+0,o,!0)}function fi(){return Symbol.iterator}function vi(){return p((function(e){return e.key}),arguments)}function mi(e){return ht.__wrap(e)}function ki(e){return ft.__wrap(e)}function Si(e){return mt.__wrap(e)}function Ri(e){return St.__wrap(e)}function Ii(e){return e.length}function Ki(e){return e.length}function Ci(e){return e.length}function Ei(){return p((function(e,t){return IDBKeyRange.lowerBound(e,0!==t)}),arguments)}function Di(e){return It.__wrap(e)}function Oi(e){return Ct.__wrap(e)}function Mi(e,t){const r=g(t.message,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function qi(e){return e.msCrypto}function Ai(e,t){const r=g(t.name,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function Bi(e){return new Set(e)}function Vi(){return new Array}function Ui(e,t){try{var r={a:e,b:t};const i=new Promise(((e,t)=>{const i=r.a;r.a=0;try{return function(e,t,r,i){n.closure431_externref_shim(e,t,r,i)}(i,r.b,e,t)}finally{r.a=i}}));return i}finally{r.a=r.b=0}}function Fi(e){return new Uint8Array(e)}function Ti(e){return new Date(e)}function Pi(){return new Object}function Ni(){return new Error}function xi(e){return new Uint8ClampedArray(e)}function zi(){return new Map}function ji(e,t){return new Function(w(e,t))}function Li(e,t,r){return new Uint8Array(e,t>>>0,r>>>0)}function Wi(e,t,r){return new Uint8ClampedArray(e,t>>>0,r>>>0)}function Gi(e){return new Uint8ClampedArray(e>>>0)}function Qi(e){return new Uint8Array(e>>>0)}function Ji(){return p((function(e,t){return new DOMException(w(e,t))}),arguments)}function Hi(){return p((function(e){return e.next()}),arguments)}function Yi(e){return e.next}function Xi(e){return e.node}function $i(e){return e.now()}function Zi(){return Date.now()}function es(e){return e.objectStoreNames}function ts(){return p((function(e,t,r){return e.objectStore(w(t,r))}),arguments)}function rs(e){return e.oldVersion}function ns(e){return At.__wrap(e)}function is(){return p((function(e){return e.openCursor()}),arguments)}function ss(){return p((function(e,t){return e.openCursor(t)}),arguments)}function os(){return p((function(e){return e.openCursor()}),arguments)}function _s(){return p((function(e,t,r){return e.open(w(t,r))}),arguments)}function as(){return p((function(e,t,r,n){return e.open(w(t,r),n>>>0)}),arguments)}function cs(e){return Vt.__wrap(e)}function gs(e){return Pt.__wrap(e)}function us(){return p((function(e,t){return JSON.parse(w(e,t))}),arguments)}function ds(e){return e.performance}function ls(e){return xt.__unwrap(e)}function ps(e){return jt.__unwrap(e)}function ys(e){return e.process}function ws(e,t){return e.push(t)}function hs(){return p((function(e,t,r){return e.put(t,r)}),arguments)}function bs(e){return Wt.__wrap(e)}function fs(e){return Qt.__wrap(e)}function vs(e){queueMicrotask(e)}function ms(e){return e.queueMicrotask}function ks(){return p((function(e,t){e.randomFillSync(t)}),arguments)}function Ss(e){const t=e.readyState;return($.indexOf(t)+1||3)-1}function Rs(e){return tr.__wrap(e)}function Is(){return p((function(){return e.require}),arguments)}function Ks(e){return Promise.resolve(e)}function Cs(){return p((function(e){return e.result}),arguments)}function Es(e){return nr.__unwrap(e)}function Ds(e){return sr.__wrap(e)}function Os(e){return _r.__wrap(e)}function Ms(e){return cr.__wrap(e)}function qs(e){return ur.__wrap(e)}function As(e){return lr.__wrap(e)}function Bs(e){return yr.__wrap(e)}function Vs(e){return hr.__wrap(e)}function Us(e){return fr.__wrap(e)}function Fs(){return p((function(e,t){return setTimeout(e,t)}),arguments)}function Ts(e,t,r){e[t>>>0]=r}function Ps(e,t,r){e.set(t,r>>>0)}function Ns(e,t,r){e[t]=r}function xs(e,t,r){e[t]=r}function zs(e,t,r){return e.set(t,r)}function js(e,t,r){e.set(t,r>>>0)}function Ls(e,t){e.onabort=t}function Ws(e,t){e.onblocked=t}function Gs(e,t){e.oncomplete=t}function Qs(e,t){e.onerror=t}function Js(e,t){e.onerror=t}function Hs(e,t){e.onsuccess=t}function Ys(e,t){e.onupgradeneeded=t}function Xs(e,t){e.onversionchange=t}function $s(e,t){e.unique=0!==t}function Zs(e){return Mr.__wrap(e)}function eo(e){return Cr.__wrap(e)}function to(e){return Dr.__wrap(e)}function ro(e,t){const r=g(t.stack,n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function no(){const e=void 0===r.g?null:r.g;return h(e)?0:l(e)}function io(){const e="undefined"==typeof globalThis?null:globalThis;return h(e)?0:l(e)}function so(){const e="undefined"==typeof self?null:self;return h(e)?0:l(e)}function oo(){const e="undefined"==typeof window?null:window;return h(e)?0:l(e)}function _o(e){return Ar.__wrap(e)}function ao(){return p((function(e){return JSON.stringify(e)}),arguments)}function co(e,t,r){return e.subarray(t>>>0,r>>>0)}function go(e){const t=e.target;return h(t)?0:l(t)}function uo(e,t){return e.then(t)}function lo(e,t,r){return e.then(t,r)}function po(e){return Vr.__wrap(e)}function yo(){return p((function(e,t,r,n){return e.transaction(w(t,r),Z[n])}),arguments)}function wo(e){const t=e.transaction;return h(t)?0:l(t)}function ho(){return p((function(e,t,r){return e.transaction(t,Z[r])}),arguments)}function bo(){return p((function(e,t){return e.update(t)}),arguments)}function fo(e){return xr.__wrap(e)}function vo(e){return jr.__wrap(e)}function mo(e){return jr.__unwrap(e)}function ko(){return p((function(e){return e.value}),arguments)}function So(e){return e.value}function Ro(e){return e.values()}function Io(e){return Wr.__wrap(e)}function Ko(e){return e.version}function Co(e){return e.versions}function Eo(e){console.warn(e)}function Do(e,t){e.warn(t)}function Oo(e){return+e}function Mo(e){return e}function qo(e){return BigInt.asUintN(64,e)}function Ao(e,t){const r="bigint"==typeof t?t:void 0;d().setBigInt64(e+8,h(r)?BigInt(0):r,!0),d().setInt32(e+0,!h(r),!0)}function Bo(e){return"boolean"==typeof e?e?1:0:2}function Vo(e){const t=e.original;return 1==t.cnt--&&(t.a=0,!0)}function Uo(e,t,r){return f(e,t,30,M)}function Fo(e,t,r){return f(e,t,410,q)}function To(e,t,r){return f(e,t,410,A)}function Po(e,t,r){return v(e,t,416,B)}function No(e,t,r){return v(e,t,416,V)}function xo(e,t){const r=g(m(t),n.__wbindgen_malloc,n.__wbindgen_realloc),i=s;d().setInt32(e+4,i,!0),d().setInt32(e+0,r,!0)}function zo(e,t){return new Error(w(e,t))}function jo(e,t){return e in t}function Lo(){const e=n.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)}function Wo(e){return Array.isArray(e)}function Go(e){return"bigint"==typeof e}function Qo(e){return"function"==typeof e}function Jo(e){return null===e}function Ho(e){return"object"==typeof e&&null!==e}function Yo(e){return"string"==typeof e}function Xo(e){return void 0===e}function $o(e,t){return e===t}function Zo(e,t){return e==t}function e_(){return n.memory}function t_(e,t){const r="number"==typeof t?t:void 0;d().setFloat64(e+8,h(r)?0:r,!0),d().setInt32(e+0,!h(r),!0)}function r_(e){return e}function n_(e,t){const r="string"==typeof t?t:void 0;var i=h(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),o=s;d().setInt32(e+4,o,!0),d().setInt32(e+0,i,!0)}function i_(e,t){return w(e,t)}function s_(e,t){throw new Error(w(e,t))}function o_(e){let t;try{t=+e}catch(e){t=e}return t}},9627:(e,t,r)=>{e.exports=r.p+"7cb3661b763a0eef328b.wasm"},3669:(e,t,r)=>{r.r(t),r.d(t,{initRustCrypto:()=>De});var n=r(4980),i=r(467),s=r(2421);const o=new URL(r(9627),r.b);s.__wbg_set_wasm(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let _=null;async function a(){_||(_=async function(){const{instance:e}=await WebAssembly.instantiateStreaming(fetch(o),{"./matrix_sdk_crypto_wasm_bg.js":s});s.__wbg_set_wasm(e.exports),e.exports.__wbindgen_start()}()),await _}var c=r(4069),g=r(6560),u=r(9561),d=r(6215),l=r(3840),p=r(9521),y=r(2986),w=r(2114),h=r(3883),b=r(8417);class f{constructor(e,t,r,i,o){this.olmMachine=e,this.keyClaimManager=t,this.outgoingRequestManager=r,this.room=i,this.encryptionSettings=o,(0,n.A)(this,"prefixedLogger",void 0),(0,n.A)(this,"lazyLoadedMembersResolved",!1),(0,n.A)(this,"currentEncryptionPromise",Promise.resolve()),this.prefixedLogger=l.v.getChild("[".concat(i.roomId," encryption]"));var _=i.getJoinedMembers();this.olmMachine.updateTrackedUsers(_.map((e=>new s.UserId(e.userId)))).catch((e=>this.prefixedLogger.error("Error initializing tracked users",e)))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==g.O.Join||e.membership==g.O.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new s.UserId(e.userId)]).catch((e=>{this.prefixedLogger.error("Unable to update tracked users",e)}))}prepareForEncryption(e,t){var r=this;return(0,i.A)((function*(){yield r.encryptEvent(null,e,t)}))()}encryptEvent(e,t,r){var n,s=this,o=new l.T(this.prefixedLogger,e?null!==(n=e.getTxnId())&&void 0!==n?n:"":"prepareForEncryption"),_=this.currentEncryptionPromise.catch((()=>{})).then((0,i.A)((function*(){yield(0,h.NQ)(o,"ensureEncryptionSession",(0,i.A)((function*(){yield s.ensureEncryptionSession(o,t,r)}))),e&&(yield(0,h.NQ)(o,"encryptEventInner",(0,i.A)((function*(){yield s.encryptEventInner(o,e)}))))})));return this.currentEncryptionPromise=_,_}ensureEncryptionSession(e,t,r){var n=this;return(0,i.A)((function*(){if("m.megolm.v1.aes-sha2"!==n.encryptionSettings.algorithm)throw new Error("Cannot encrypt in ".concat(n.room.roomId," for unsupported algorithm '").concat(n.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var o=yield n.room.getEncryptionTargetMembers();n.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),n.outgoingRequestManager.doProcessOutgoingRequests()):(yield(0,h.NQ)(n.prefixedLogger,"loadMembersIfNeeded: updateTrackedUsers",(0,i.A)((function*(){yield n.olmMachine.updateTrackedUsers(o.map((e=>new s.UserId(e.userId))))}))),e.debug("Updated tracked users"),n.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield(0,h.NQ)(n.prefixedLogger,"doProcessOutgoingRequests",(0,i.A)((function*(){yield n.outgoingRequestManager.doProcessOutgoingRequests()})))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(n.room.shouldEncryptForInvitedMembers(),"):"),o.map((e=>"".concat(e.userId," (").concat(e.membership,")"))));var _=o.map((e=>new s.UserId(e.userId)));yield(0,h.NQ)(n.prefixedLogger,"ensureSessionsForUsers",(0,i.A)((function*(){yield n.keyClaimManager.ensureSessionsForUsers(e,_)})));var a=new s.EncryptionSettings;switch(a.historyVisibility=function(e){switch(e){case w.Jv.Invited:return s.HistoryVisibility.Invited;case w.Jv.Joined:return s.HistoryVisibility.Joined;case w.Jv.Shared:return s.HistoryVisibility.Shared;case w.Jv.WorldReadable:return s.HistoryVisibility.WorldReadable}}(n.room.getHistoryVisibility()),a.algorithm=s.EncryptionAlgorithm.MegolmV1AesSha2,"number"==typeof n.encryptionSettings.rotation_period_ms&&(a.rotationPeriod=BigInt(1e3*n.encryptionSettings.rotation_period_ms)),"number"==typeof n.encryptionSettings.rotation_period_msgs&&(a.rotationPeriodMessages=BigInt(n.encryptionSettings.rotation_period_msgs)),r.kind){case b.DeviceIsolationModeKind.AllDevicesIsolationMode:var c,g=null!==(c=n.room.getBlacklistUnverifiedDevices())&&void 0!==c?c:t;a.sharingStrategy=s.CollectStrategy.deviceBasedStrategy(g,r.errorOnVerifiedUserProblems);break;case b.DeviceIsolationModeKind.OnlySignedDevicesIsolationMode:a.sharingStrategy=s.CollectStrategy.identityBasedStrategy()}yield(0,h.NQ)(n.prefixedLogger,"shareRoomKey",(0,i.A)((function*(){var e=yield n.olmMachine.shareRoomKey(new s.RoomId(n.room.roomId),_,a);if(e)for(var t of e)yield n.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(t)})))}))()}forceDiscardSession(){var e=this;return(0,i.A)((function*(){(yield e.olmMachine.invalidateGroupSession(new s.RoomId(e.room.roomId)))&&e.prefixedLogger.info("Discarded existing group session")}))()}encryptEventInner(e,t){var r=this;return(0,i.A)((function*(){e.debug("Encrypting actual message content");var n=yield r.olmMachine.encryptRoomEvent(new s.RoomId(r.room.roomId),t.getType(),JSON.stringify(t.getContent()));t.makeEncrypted(y.Bx.RoomMessageEncrypted,JSON.parse(n),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")}))()}}var v=r(7723),m=r(6387),k="/_matrix/client/unstable/org.matrix.msc3814.v1",S="org.matrix.msc3814";class R extends m.X{constructor(e,t,r,i,s){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=i,this.secretStorage=s,(0,n.A)(this,"intervalId",void 0)}cacheKey(e){var t=this;return(0,i.A)((function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(b.CryptoEvent.DehydrationKeyCached)}))()}isSupported(){var e=this;return(0,i.A)((function*(){try{yield e.http.authedRequest(p.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:k})}catch(e){var t=e;if("M_UNRECOGNIZED"===t.errcode)return!1;if("M_NOT_FOUND"===t.errcode)return!0;throw e}return!0}))()}start(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if("boolean"==typeof r&&(r={createNewKey:r}),!r.onlyIfKeyCached||(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey())){if(t.stop(),!1!==r.rehydrate)try{yield t.rehydrateDeviceIfAvailable()}catch(e){t.logger.info("dehydration: Error rehydrating device:",e),t.emit(b.CryptoEvent.RehydrationError,e.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}}))()}isKeyStored(){var e=this;return(0,i.A)((function*(){return Boolean(yield e.secretStorage.isStored(S))}))()}resetKey(){var e=this;return(0,i.A)((function*(){var t=s.DehydratedDeviceKey.createRandomKey();return yield e.secretStorage.store(S,t.toBase64()),yield e.cacheKey(t),t}))()}getKey(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var n=yield t.secretStorage.get(S);if(void 0===n)return e?yield t.resetKey():null;var i=(0,v.y4)(n);try{var o=s.DehydratedDeviceKey.createKeyFromArray(i);return yield t.cacheKey(o),o}finally{i.fill(0)}}))()}rehydrateDeviceIfAvailable(){var e=this;return(0,i.A)((function*(){var t,r=yield e.getKey(!1);if(!r)return!1;try{t=yield e.http.authedRequest(p.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:k})}catch(t){var n=t;if("M_NOT_FOUND"===n.errcode||"M_UNRECOGNIZED"===n.errcode)return e.logger.info("dehydration: No dehydrated device"),!1;throw n}e.logger.info("dehydration: dehydrated device found"),e.emit(b.CryptoEvent.RehydrationStarted);var i=yield e.olmMachine.dehydratedDevices().rehydrate(r,new s.DeviceId(t.device_id),JSON.stringify(t.device_data));e.logger.info("dehydration: device rehydrated");for(var o=void 0,_=0,a=0,c=(0,h.RR)("/dehydrated_device/$device_id/events",{$device_id:t.device_id});;){var g=yield e.http.authedRequest(p.IT.Post,c,void 0,o?{next_batch:o}:{},{prefix:k});if(0===g.events.length)break;_+=g.events.length,o=g.next_batch,a+=(yield i.receiveEvents(JSON.stringify(g.events))).length,e.emit(b.CryptoEvent.RehydrationProgress,a,_)}return e.logger.info("dehydration: received ".concat(a," room keys from ").concat(_," to-device events")),e.emit(b.CryptoEvent.RehydrationCompleted),!0}))()}createAndUploadDehydratedDevice(){var e=this;return(0,i.A)((function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(b.CryptoEvent.DehydratedDeviceCreated);var n=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(n),e.emit(b.CryptoEvent.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")}))()}scheduleDeviceDehydration(){var e=this;return(0,i.A)((function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval((()=>{e.createAndUploadDehydratedDevice().catch((t=>{e.emit(b.CryptoEvent.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)}))}),6048e5)}))()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}class K{constructor(e,t){this.olmMachine=e,this.http=t}makeOutgoingRequest(e,t){var r=this;return(0,i.A)((function*(){var n;if(e instanceof s.KeysUploadRequest)n=yield r.requestWithRetry(p.IT.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof s.KeysQueryRequest)n=yield r.requestWithRetry(p.IT.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof s.KeysClaimRequest)n=yield r.requestWithRetry(p.IT.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof s.SignatureUploadRequest)n=yield r.requestWithRetry(p.IT.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof s.KeysBackupRequest)n=yield r.requestWithRetry(p.IT.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof s.ToDeviceRequest)n=yield r.sendToDeviceRequest(e);else if(e instanceof s.RoomMessageRequest){var o="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));n=yield r.requestWithRetry(p.IT.Put,o,{},e.body)}else{if(e instanceof s.UploadSigningKeysRequest)return void(yield r.makeRequestWithUIA(p.IT.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t));if(e instanceof s.PutDehydratedDeviceRequest){var _=k+"/dehydrated_device";return void(yield r.rawJsonRequest(p.IT.Put,_,{},e.body))}l.v.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),n=""}if(e.id)try{yield(0,h.NQ)(l.v,"Mark Request as sent ".concat(e.type),(0,i.A)((function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,n)})))}catch(e){if(!(e instanceof Error)||"Attempt to use a moved value"!==e.message&&"null pointer passed to rust"!==e.message)throw e;l.v.log("Ignoring error '".concat(e.message,"': client is likely shutting down"))}else l.v.trace("Outgoing request type:".concat(e.type," does not have an ID"))}))()}sendToDeviceRequest(e){var t=this;return(0,i.A)((function*(){var r=JSON.parse(e.body),n=[];for(var[i,s]of Object.entries(r.messages))for(var[o,_]of Object.entries(s))n.push("".concat(i,"/").concat(o," (msgid ").concat(_[y.wt],")"));l.v.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),n);var a="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(p.IT.Put,a,{},e.body)}))()}makeRequestWithUIA(e,t,r,s,o){var _=this;return(0,i.A)((function*(){if(!o)return yield _.requestWithRetry(e,t,r,s);var a=JSON.parse(s),c=function(){var s=(0,i.A)((function*(i){var s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a);null!==i&&(s.auth=i);var o=yield _.requestWithRetry(e,t,r,JSON.stringify(s));return JSON.parse(o)}));return function(e){return s.apply(this,arguments)}}(),g=yield o(c);return JSON.stringify(g)}))()}requestWithRetry(e,t,r,n){var s=this;return(0,i.A)((function*(){for(var i=0;;)try{return yield s.rawJsonRequest(e,t,r,n)}catch(e){i++;var o=(0,p.fZ)(e,i,!0);if(o<0)throw e;yield(0,h.yy)(o)}}))()}rawJsonRequest(e,t,r,n){var s=this;return(0,i.A)((function*(){return yield s.http.authedRequest(e,t,r,n,{json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:""})}))()}}class C{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,(0,n.A)(this,"currentClaimPromise",void 0),(0,n.A)(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch((()=>{})).then((()=>this.ensureSessionsForUsersInner(e,t)));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return(0,i.A)((function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var n=yield r.olmMachine.getMissingSessions(t.map((e=>e.clone())));n&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(n)),e.info("Olm sessions prepared")}))()}}var E=r(7131);function D(e,t){var r=new Map;for(var[n,i]of e.keys.entries())r.set(n.toString(),i.toBase64());var o=E.u.Unverified;e.isBlacklisted()?o=E.u.Blocked:e.isVerified()&&(o=E.u.Verified);var _=new Map,a=e.signatures.get(t);if(a){var c=new Map;for(var[g,u]of a.entries())u.isValid()&&u.signature&&c.set(g,u.signature.toBase64());_.set(t.toString(),c)}var d=e.algorithms,l=new Set;return d.forEach((e=>{switch(e){case s.EncryptionAlgorithm.MegolmV1AesSha2:l.add("m.megolm.v1.aes-sha2");break;case s.EncryptionAlgorithm.OlmV1Curve25519AesSha2:default:l.add("m.olm.v1.curve25519-aes-sha2")}})),new E.p({deviceId:e.deviceId.toString(),userId:t.toString(),keys:r,algorithms:Array.from(l),verified:o,signatures:_,displayName:e.displayName,dehydrated:e.isDehydrated})}function O(e){var t,r=new Map(Object.entries(e.keys)),n=null===(t=e.unsigned)||void 0===t?void 0:t.device_display_name,i=new Map;if(e.signatures)for(var s in e.signatures)i.set(s,new Map(Object.entries(e.signatures[s])));return new E.p({deviceId:e.device_id,userId:e.user_id,keys:r,algorithms:e.algorithms,verified:E.u.Unverified,signatures:i,displayName:n})}var M=r(6900);class q{constructor(e,t,r){this.olmMachine=e,this.outgoingRequestProcessor=t,this.secretStorage=r}bootstrapCrossSigning(e){var t=this;return(0,i.A)((function*(){if(e.setupNewCrossSigning)yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);else{var r=yield t.olmMachine.crossSigningStatus(),n=yield t.secretStorage.get("m.cross_signing.master"),i=yield t.secretStorage.get("m.cross_signing.self_signing"),s=yield t.secretStorage.get("m.cross_signing.user_signing"),o=Boolean(n&&i&&s),_=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(l.v.log("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:o}),_)(yield t.secretStorage.hasKey())?o?l.v.log("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(l.v.log("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):l.v.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(o){l.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var a=yield t.olmMachine.importCrossSigningKeys(n,i,s);if(!a.hasMaster||!a.hasSelfSigning||!a.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var c=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var g=yield c.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(g)}finally{c.free()}}else l.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);l.v.log("bootstrapCrossSigning: complete")}}))()}resetCrossSigning(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);for(var n of((yield t.secretStorage.hasKey())?(l.v.log("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):l.v.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),l.v.log("resetCrossSigning: publishing public keys to server"),[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest]))n&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(n,e))}))()}exportCrossSigningKeysToStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.exportCrossSigningKeys();null!=t&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):l.v.error("Cannot export MSK to secret storage, private key unknown"),null!=t&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):l.v.error("Cannot export SSK to secret storage, private key unknown"),null!=t&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):l.v.error("Cannot export USK to secret storage, private key unknown")}))()}}function A(e){return B.apply(this,arguments)}function B(){return(B=(0,i.A)((function*(e){return V(e,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])}))).apply(this,arguments)}function V(e,t){return U.apply(this,arguments)}function U(){return(U=(0,i.A)((function*(e,t){var r=yield e.getDefaultKeyId();if(!r)return!1;for(var n of t)if(!(r in((yield e.isStored(n))||{})))return!1;return!0}))).apply(this,arguments)}var F=r(4400),T=r(4831),P=r(9255);class N extends m.X{constructor(e,t,r,s){super(),this.olmMachine=e,this.inner=t,this.outgoingRequestProcessor=r,this.supportedVerificationMethods=s,(0,n.A)(this,"reEmitter",void 0),(0,n.A)(this,"_accepting",!1),(0,n.A)(this,"_cancelling",!1),(0,n.A)(this,"_verifier",void 0),this.reEmitter=new T.Q(this);var o=new WeakRef(this);t.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=o.deref())||void 0===e?void 0:e.onChange()})))}onChange(){var e=this.inner.getVerification();e instanceof s.Sas?void 0===this._verifier||this._verifier instanceof z?this.setVerifier(new j(e,this,this.outgoingRequestProcessor)):this._verifier instanceof j&&this._verifier.replaceInner(e):e instanceof s.Qr&&void 0===this._verifier&&this.setVerifier(new z(e,this.outgoingRequestProcessor)),this.emit(F.FM.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[F.FM.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[F.FM.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return null===(e=this.inner.roomId)||void 0===e?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return null===(e=this.inner.otherDeviceId)||void 0===e?void 0:e.toString()}getOtherDevice(){var e=this;return(0,i.A)((function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)}))()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case s.VerificationRequestPhase.Created:case s.VerificationRequestPhase.Requested:return F.X9.Requested;case s.VerificationRequestPhase.Ready:return this._accepting?F.X9.Requested:F.X9.Ready;case s.VerificationRequestPhase.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case s.VerificationRequestPhase.Done:return F.X9.Done;case s.VerificationRequestPhase.Cancelled:return F.X9.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==F.X9.Done&&e!==F.X9.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==F.X9.Started)return null;var e=this.inner.getVerification();return e instanceof s.Sas?P.V.Sas:e instanceof s.Qr?P.V.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(void 0===t)return!1;var r=L[e];return t.some((e=>e===r))}accept(){var e=this;return(0,i.A)((function*(){if(e.inner.phase()!==s.VerificationRequestPhase.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(W));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(F.FM.Change)}))()}cancel(e){var t=this;return(0,i.A)((function*(){if(!t._cancelling){t._cancelling=!0;try{var e=t.inner.cancel();e&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(e))}finally{t._cancelling=!1}}}))()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return(0,i.A)((function*(){if(e!==P.V.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,n]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier}))()}scanQRCode(e){var t=this;return(0,i.A)((function*(){var r=s.QrCodeScan.fromBytes(e),n=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var i=n.reciprocate();return i&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(i)),t._verifier}))()}get verifier(){return this.phase===F.X9.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return(0,i.A)((function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()}))()}get cancellationCode(){var e,t;return null!==(e=null===(t=this.inner.cancelInfo)||void 0===t?void 0:t.cancelCode())&&void 0!==e?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;return e?e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString():void 0}}class x extends m.X{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,(0,n.A)(this,"completionDeferred",void 0),this.completionDeferred=(0,h.v6)();var r=new WeakRef(this);e.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=r.deref())||void 0===e?void 0:e.onChange()}))),this.completionDeferred.promise.catch((()=>null))}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(F.FM.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}class z extends x{constructor(e,t){super(e,t),(0,n.A)(this,"callbacks",null)}onChange(){null===this.callbacks&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:()=>{this.confirmScanning()},cancel:()=>this.cancel()}),super.onChange()}verify(){var e=this;return(0,i.A)((function*(){null!==e.callbacks&&e.emit(F.Ji.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise}))()}get verificationPhase(){switch(this.inner.state()){case s.QrState.Created:return F.X9.Ready;case s.QrState.Scanned:case s.QrState.Confirmed:case s.QrState.Reciprocated:return F.X9.Started;case s.QrState.Done:return F.X9.Done;case s.QrState.Cancelled:return F.X9.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return(0,i.A)((function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}}class j extends x{constructor(e,t,r){super(e,r),(0,n.A)(this,"callbacks",null)}verify(){var e=this;return(0,i.A)((function*(){yield e.sendAccept(),yield e.completionDeferred.promise}))()}sendAccept(){var e=this;return(0,i.A)((function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}onChange(){var e,t=this;if(super.onChange(),null===this.callbacks){var r=this.inner.emoji(),n=this.inner.decimals();if(void 0===r&&void 0===n)return;var s={};r&&(s.emoji=r.map((e=>[e.symbol,e.description]))),n&&(s.decimal=[n[0],n[1],n[2]]),this.callbacks={sas:s,confirm:(e=(0,i.A)((function*(){var e=yield t.inner.confirm();for(var r of e)yield t.outgoingRequestProcessor.makeOutgoingRequest(r)})),function(){return e.apply(this,arguments)}),mismatch:()=>{var e=this.inner.cancelWithCode("m.mismatched_sas");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)},cancel:()=>{var e=this.inner.cancelWithCode("m.user");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)}},this.emit(F.Ji.ShowSas,this.callbacks)}}get verificationPhase(){return F.X9.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=t.deref())||void 0===e?void 0:e.onChange()}))),this.sendAccept(),this.onChange()}}}var L={[P.V.Sas]:s.VerificationMethod.SasV1,[P.V.ScanQrCode]:s.VerificationMethod.QrCodeScanV1,[P.V.ShowQrCode]:s.VerificationMethod.QrCodeShowV1,[P.V.Reciprocate]:s.VerificationMethod.ReciprocateV1};function W(e){var t=L[e];if(void 0===t)throw new Error("Unknown verification method ".concat(e));return t}class G extends m.X{constructor(e,t,r){super(),this.olmMachine=e,this.http=t,this.outgoingRequestProcessor=r,(0,n.A)(this,"checkedForBackup",!1),(0,n.A)(this,"serverBackupInfo",void 0),(0,n.A)(this,"activeBackupVersion",null),(0,n.A)(this,"stopped",!1),(0,n.A)(this,"backupKeysLoopRunning",!1),(0,n.A)(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return(0,i.A)((function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null}))()}getServerBackupInfo(){var e=this;return(0,i.A)((function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo}))()}isKeyBackupTrusted(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.verifyBackup(e),n=yield t.olmMachine.getBackupKeys(),i=null==n?void 0:n.decryptionKey;return{matchesDecryptionKey:!!i&&Q(e,i),trusted:r.trusted()}}))()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally((()=>{this.keyBackupCheckInProgress=null}))),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return(0,i.A)((function*(){var r,n=yield t.checkKeyBackupAndEnable(!0);if(null==n||null===(r=n.backupInfo)||void 0===r||!r.version||!n.trustInfo.trusted)return l.v.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var i=s.BackupDecryptionKey.fromBase64(e);return Q(n.backupInfo,i)?(l.v.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(i,n.backupInfo.version),!0):(l.v.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(e){l.v.warn("handleBackupSecretReceived: Invalid backup decryption key",e)}return!1}))()}saveBackupDecryptionKey(e,t){var r=this;return(0,i.A)((function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(b.CryptoEvent.KeyBackupDecryptionKeyCached,t)}))()}importRoomKeys(e,t){var r=this;return(0,i.A)((function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,i.A)((function*(){yield r.olmMachine.importExportedRoomKeys(e,((e,r)=>{var n,i={total:Number(r),successes:Number(e),stage:"load_keys",failures:0};null==t||null===(n=t.progressCallback)||void 0===n||n.call(t,i)}))}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,i.A)((function*(){var i=new Map;for(var o of e){var _=new s.RoomId(o.room_id);i.has(_)||i.set(_,new Map),i.get(_).set(o.session_id,o)}yield n.olmMachine.importBackedUpRoomKeys(i,((e,t,n)=>{var i,s={total:Number(t),successes:Number(e),stage:"load_keys",failures:Number(n)};null==r||null===(i=r.progressCallback)||void 0===i||i.call(r,s)}),t)}))()}doCheckKeyBackup(){var e=this;return(0,i.A)((function*(){var t;l.v.log("Checking key backup status...");try{t=yield e.requestKeyBackupVersion()}catch(t){return l.v.warn("Error checking for active key backup",t),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(l.v.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return null!==r?(l.v.log("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):l.v.log("No key backup present on server: not enabling key backup"),null;var n=yield e.isKeyBackupTrusted(t);return n.trusted?null===r?(l.v.log("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(l.v.log("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):l.v.log("Backup version ".concat(t.version," still current")):null!==r?(l.v.log("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):l.v.log("Key backup present on server but not trusted: not enabling key backup"),{backupInfo:t,trustInfo:n}}))()}enableKeyBackup(e){var t=this;return(0,i.A)((function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(b.CryptoEvent.KeyBackupStatus,!0),t.backupKeysLoop()}))()}maybeUploadKey(){var e=this;return(0,i.A)((function*(){null!=e.activeBackupVersion&&e.backupKeysLoop()}))()}disableKeyBackup(){var e=this;return(0,i.A)((function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(b.CryptoEvent.KeyBackupStatus,!1)}))()}backupKeysLoop(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:1e4;if(t.backupKeysLoopRunning)l.v.log("Backup loop already running");else{t.backupKeysLoopRunning=!0,l.v.log("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var n=Math.random()*r;yield(0,h.yy)(n);try{for(var s=0,o=null,_=!0;!t.stopped;){var a=null;try{a=yield(0,h.NQ)(l.v,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",(0,i.A)((function*(){return yield t.olmMachine.backupRoomKeys()})))}catch(e){l.v.error("Backup: Failed to get keys to backup from rust crypto-sdk",e)}if(!a||t.stopped||!t.activeBackupVersion)return l.v.log("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),void(a||t.emit(b.CryptoEvent.KeyBackupSessionsRemaining,0));try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(a),s=0,t.stopped)break;if(!_&&null===o)try{var c=yield t.olmMachine.roomKeyCounts();o=c.total-c.backedUp}catch(e){l.v.error("Backup: Failed to get key counts from rust crypto-sdk",e)}if(null!==o){t.emit(b.CryptoEvent.KeyBackupSessionsRemaining,o);var g=t.keysCountInBatch(a);o=Math.max(o-g,0)}}catch(e){if(s++,l.v.error("Backup: Error processing backup request for rust crypto-sdk",e),e instanceof p.up){var u=e.data.errcode;if("M_NOT_FOUND"==u||"M_WRONG_ROOM_KEYS_VERSION"==u){l.v.log("Backup: Failed to upload keys to current vesion: ".concat(u,"."));try{yield t.disableKeyBackup()}catch(e){l.v.error("Backup: An error occurred while disabling key backup:",e)}return t.emit(b.CryptoEvent.KeyBackupFailed,e.data.errcode),t.backupKeysLoopRunning=!1,void t.checkKeyBackupAndEnable(!0)}if(e.isRateLimitError())try{var d=e.getRetryAfterMs();if(d&&d>0){yield(0,h.yy)(d);continue}}catch(e){l.v.warn("Backup: An error occurred while retrieving a rate-limit retry delay",e)}}yield(0,h.yy)(1e3*Math.pow(2,Math.min(s-1,4)))}_=!1}}finally{t.backupKeysLoopRunning=!1}}}))()}keysCountInBatch(e){return $(JSON.parse(e.body))}requestKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){return yield H(t.http,e)}))()}setupKeyBackup(e){var t=this;return(0,i.A)((function*(){yield t.deleteAllKeyBackupVersions();var r=s.BackupDecryptionKey.createRandomKey(),n=r.megolmV1PublicKey,i={public_key:n.publicKeyBase64};yield e(i);var o=yield t.http.authedRequest(p.IT.Post,"/room_keys/version",void 0,{algorithm:n.algorithm,auth_data:i},{prefix:p.iD.V3});return yield t.saveBackupDecryptionKey(r,o.version),{version:o.version,algorithm:n.algorithm,authData:i,decryptionKey:r}}))()}deleteAllKeyBackupVersions(){var e=this;return(0,i.A)((function*(){for(var t,r,n=null!==(t=null===(r=yield e.requestKeyBackupVersion())||void 0===r?void 0:r.version)&&void 0!==t?t:null;null!=n;){var i,s;yield e.deleteKeyBackupVersion(n),n=null!==(i=null===(s=yield e.requestKeyBackupVersion())||void 0===s?void 0:s.version)&&void 0!==i?i:null}}))()}deleteKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){l.v.debug("deleteKeyBackupVersion v:".concat(e));var r=(0,h.RR)("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(p.IT.Delete,r,void 0,void 0,{prefix:p.iD.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())}))()}createBackupDecryptor(e){return new J(e)}restoreKeyBackup(e,t,r){var n=this;return(0,i.A)((function*(){var i,s=yield n.downloadKeyBackup(e);return null==r||null===(i=r.progressCallback)||void 0===i||i.call(r,{stage:"load_keys"}),n.importKeyBackup(s,e,t,r)}))()}downloadKeyBackup(e){return this.http.authedRequest(p.IT.Get,"/room_keys/keys",{version:e},void 0,{prefix:p.iD.V3})}importKeyBackup(e,t,r,n){var s=this;return(0,i.A)((function*(){var o=$(e),_=0,a=0,c=function(){var e=(0,i.A)((function*(e){var i,c=[],g=function*(t){(yield r.decryptSessions(e.get(t))).forEach((e=>{e.room_id=t,c.push(e)}))};for(var u of e.keys())yield*g(u);try{yield s.importBackedUpRoomKeys(c,t),_+=c.length}catch(e){a+=c.length,l.v.error("Error importing keys from backup",e)}null==n||null===(i=n.progressCallback)||void 0===i||i.call(n,{total:o,successes:_,stage:"load_keys",failures:a})}));return function(t){return e.apply(this,arguments)}}(),g=0,u=new Map;for(var[d,p]of Object.entries(e.rooms))if(p.sessions)for(var[y,w]of(u.set(d,{}),Object.entries(p.sessions)))u.get(d)[y]=w,(g+=1)>=200&&(yield c(u),(u=new Map).set(d,{}),g=0);return g>0&&(yield c(u)),{total:o,imported:_}}))()}}function Q(e,t){var r;return"m.megolm_backup.v1.curve25519-aes-sha2"!==e.algorithm?(l.v.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):(null===(r=e.auth_data)||void 0===r?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}class J{constructor(e){(0,n.A)(this,"decryptionKey",void 0),(0,n.A)(this,"sourceTrusted",void 0),this.decryptionKey=e,this.sourceTrusted=!1}decryptSessions(e){var t=this;return(0,i.A)((function*(){var r=[];for(var[n,i]of Object.entries(e))try{var s=JSON.parse(t.decryptionKey.decryptV1(i.session_data.ephemeral,i.session_data.mac,i.session_data.ciphertext));s.session_id=n,r.push(s)}catch(e){l.v.log("Failed to decrypt megolm session from backup",e,i)}return r}))()}free(){this.decryptionKey.free()}}function H(e,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,i.A)((function*(e,t){try{var r=t?(0,h.RR)("/room_keys/version/$version",{$version:t}):"/room_keys/version";return yield e.authedRequest(p.IT.Get,r,void 0,void 0,{prefix:p.iD.V3})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}}))).apply(this,arguments)}function X(e,t){return t.auth_data.public_key===e.megolmV1PublicKey.publicKeyBase64}function $(e){var t=0;for(var{sessions:r}of Object.values(e.rooms))t+=Object.keys(r).length;return t}var Z=r(5942),ee=r(4575);class te{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,(0,n.A)(this,"stopped",!1),(0,n.A)(this,"outgoingRequestLoopRunning",!1),(0,n.A)(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=(0,h.v6)());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch((e=>{this.logger.error("Uncaught error in outgoing request loop",e)})),e}outgoingRequestLoop(){var e=this;return(0,i.A)((function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{for(;!e.stopped&&e.nextLoopDeferred;){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))}))()}processOutgoingRequests(){var e=this;return(0,i.A)((function*(){if(!e.stopped){var t,r=yield e.olmMachine.outgoingRequests(),n=function*(t){if(e.stopped)return{v:void 0};try{yield(0,h.NQ)(e.logger,"Make outgoing request ".concat(t.type),(0,i.A)((function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(t)})))}catch(r){e.logger.error("Failed to process outgoing request ".concat(t.type,": ").concat(r))}};for(var s of r)if(t=yield*n(s))return t.v}}))()}}var re=5e3,ne=function(e){return e.MISSING_DECRYPTION_KEY="MISSING_DECRYPTION_KEY",e.NETWORK_ERROR="NETWORK_ERROR",e.STOPPED="STOPPED",e}(ne||{});class ie extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}}class se extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}}class oe{constructor(e,t,r,i){this.olmMachine=t,this.http=r,this.backupManager=i,(0,n.A)(this,"stopped",!1),(0,n.A)(this,"configuration",null),(0,n.A)(this,"sessionLastCheckAttemptedTime",new Map),(0,n.A)(this,"logger",void 0),(0,n.A)(this,"downloadLoopRunning",!1),(0,n.A)(this,"queuedRequests",[]),(0,n.A)(this,"hasConfigurationProblem",!1),(0,n.A)(this,"currentBackupVersionCheck",null),(0,n.A)(this,"onBackupStatusChanged",(()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then((e=>{e&&this.downloadKeysLoop()}))})),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),i.on(b.CryptoEvent.KeyBackupStatus,this.onBackupStatusChanged),i.on(b.CryptoEvent.KeyBackupFailed,this.onBackupStatusChanged),i.on(b.CryptoEvent.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return null!==this.configuration}getServerBackupInfo(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.getServerBackupInfo()}))()}onDecryptionKeyMissingError(e,t){this.isAlreadyInQueue(e,t)?this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued")):this.wasRequestedRecently(t)?this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently")):(this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop())}stop(){this.stopped=!0,this.backupManager.off(b.CryptoEvent.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(b.CryptoEvent.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(b.CryptoEvent.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some((r=>r.roomId==e&&r.megolmSessionId==t))}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter(((e,r)=>Math.max(t-r,0)<re))))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return!!t&&Math.max(Date.now()-t,0)<re}getBackupDecryptionKey(){var e=this;return(0,i.A)((function*(){try{return yield e.olmMachine.getBackupKeys()}catch(e){return null}}))()}requestRoomKeyFromBackup(e,t,r){var n=this;return(0,i.A)((function*(){var i=(0,h.RR)("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield n.http.authedRequest(p.IT.Get,i,{version:e},void 0,{prefix:p.iD.V3})}))()}downloadKeysLoop(){var e=this;return(0,i.A)((function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{for(;e.queuedRequests.length>0;){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r)return void(e.downloadLoopRunning=!1);var n=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,n,r)}catch(r){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),r)}e.queuedRequests.shift()}catch(r){if(r instanceof ie)switch(r.code){case ne.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case ne.NETWORK_ERROR:yield(0,h.yy)(re);break;case ne.STOPPED:return void(e.downloadLoopRunning=!1)}else r instanceof se&&(yield(0,h.yy)(r.retryMillis))}}}finally{e.downloadLoopRunning=!1}}}))()}queryKeyBackup(e,t,r){var n=this;return(0,i.A)((function*(){if(n.logger.debug("Checking key backup for session ".concat(t)),n.stopped)throw new ie(ne.STOPPED);try{var i=yield n.requestRoomKeyFromBackup(r.backupVersion,e,t);return n.logger.debug("Got key from backup for sessionId:".concat(t)),i}catch(e){if(n.stopped)throw new ie(ne.STOPPED);if(n.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(e)),e instanceof p.up){if("M_NOT_FOUND"==e.data.errcode)throw new ie(ne.MISSING_DECRYPTION_KEY);if(e.isRateLimitError()){var s,o;try{var _;o=null!==(_=e.getRetryAfterMs())&&void 0!==_?_:void 0}catch(e){n.logger.warn("Error while retrieving a rate-limit retry delay",e)}throw o&&o>0&&n.logger.info("Rate limited by server, waiting ".concat(o,"ms")),new se(null!==(s=o)&&void 0!==s?s:re)}}throw new ie(ne.NETWORK_ERROR)}}))()}decryptAndImport(e,t,r){var n=this;return(0,i.A)((function*(){var i={[e.megolmSessionId]:t},s=yield r.decryptor.decryptSessions(i);for(var o of s)o.room_id=e.roomId;yield n.backupManager.importBackedUpRoomKeys(s,r.backupVersion)}))()}getOrCreateBackupConfiguration(){var e=this;return(0,i.A)((function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(null!=e.currentBackupVersionCheck)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}}))()}internalCheckFromServer(){var e=this;return(0,i.A)((function*(){var t,r,n,i,s=null;try{s=yield e.backupManager.getServerBackupInfo()}catch(t){return e.logger.debug("Backup: error while checking server version: ".concat(t)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat(null===(t=s)||void 0===t?void 0:t.version)),"m.megolm_backup.v1.curve25519-aes-sha2"!=(null===(r=s)||void 0===r?void 0:r.algorithm))return e.logger.info("Unsupported algorithm ".concat(null===(i=s)||void 0===i?void 0:i.algorithm)),e.hasConfigurationProblem=!0,null;if(null===(n=s)||void 0===n||!n.version)return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var o=yield e.backupManager.getActiveBackupVersion();if(null==o||s.version!=o)return e.logger.info("The current backup version on the server (".concat(s.version,") is not trusted. Version we are currently backing up to: ").concat(o)),e.hasConfigurationProblem=!0,null;var _=yield e.getBackupDecryptionKey();if(null==_||!_.decryptionKey)return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(o!=_.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(_.backupVersion,") doesn't match the version we are backing up to (").concat(o,")")),e.hasConfigurationProblem=!0,null;if(s.auth_data.public_key!=_.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var a=e.backupManager.createBackupDecryptor(_.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:a,backupVersion:o},e.configuration}))()}}var _e=r(4304);function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ge=[P.V.Sas,P.V.ScanQrCode,P.V.ShowQrCode,P.V.Reciprocate];class ue extends m.X{constructor(e,t,r,i,s,o,_){super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=i,this.secretStorage=o,this.cryptoCallbacks=_,(0,n.A)(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),(0,n.A)(this,"_trustCrossSignedDevices",!0),(0,n.A)(this,"deviceIsolationMode",new b.AllDevicesIsolationMode(!1)),(0,n.A)(this,"stopped",!1),(0,n.A)(this,"roomEncryptors",{}),(0,n.A)(this,"eventDecryptor",void 0),(0,n.A)(this,"keyClaimManager",void 0),(0,n.A)(this,"outgoingRequestProcessor",void 0),(0,n.A)(this,"crossSigningIdentity",void 0),(0,n.A)(this,"backupManager",void 0),(0,n.A)(this,"outgoingRequestsManager",void 0),(0,n.A)(this,"perSessionBackupDownloader",void 0),(0,n.A)(this,"dehydratedDeviceManager",void 0),(0,n.A)(this,"reemitter",new T.Q(this)),(0,n.A)(this,"globalBlacklistUnverifiedDevices",!1),(0,n.A)(this,"_supportedVerificationMethods",ge),this.outgoingRequestProcessor=new K(t,r),this.outgoingRequestsManager=new te(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new C(t,this.outgoingRequestProcessor),this.backupManager=new G(t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new oe(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new R(this.logger,t,r,this.outgoingRequestProcessor,o),this.eventDecryptor=new de(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[b.CryptoEvent.KeyBackupStatus,b.CryptoEvent.KeyBackupSessionsRemaining,b.CryptoEvent.KeyBackupFailed,b.CryptoEvent.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[b.CryptoEvent.DehydratedDeviceCreated,b.CryptoEvent.DehydratedDeviceUploaded,b.CryptoEvent.RehydrationStarted,b.CryptoEvent.RehydrationProgress,b.CryptoEvent.RehydrationCompleted,b.CryptoEvent.RehydrationError,b.CryptoEvent.DehydrationKeyCached,b.CryptoEvent.DehydratedDeviceRotationError]),this.crossSigningIdentity=new q(t,this.outgoingRequestProcessor,o),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new ee.LA;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return(0,i.A)((function*(){var t=e.getRoomId(),n=r.roomEncryptors[t];if(!n)throw new Error("Cannot encrypt event in unconfigured room ".concat(t));yield n.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)}))()}decryptEvent(e){var t=this;return(0,i.A)((function*(){if(!e.getRoomId())throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)}))()}getEventEncryptionInfo(e){var t,r={};return r.senderKey=null!==(t=e.getSenderKey())&&void 0!==t?t:void 0,r.algorithm=e.getWireContent().algorithm,r.senderKey&&r.algorithm?(r.encrypted=!0,r.authenticated=!0,r.mismatchedSender=!0,r):(r.encrypted=!1,r)}checkUserTrust(e){return new b.UserVerificationStatus(!1,!1,!1)}getStoredCrossSigningForUser(e){return null}checkOwnCrossSigningTrust(){return(0,i.A)((function*(){}))()}getBackupDecryptor(e,t){var r=this;return(0,i.A)((function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if("m.megolm_backup.v1.curve25519-aes-sha2"!=e.algorithm)throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var n=s.BackupDecryptionKey.fromBase64((0,v.WG)(t));if(!X(n,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(n)}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,i.A)((function*(){return yield n.backupManager.importBackedUpRoomKeys(e,t,r)}))()}getVersion(){var e=s.getVersions();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getRoomSettings(new s.RoomId(e));return Boolean(null==r?void 0:r.algorithm)}))()}getOwnDeviceKeys(){var e=this;return(0,i.A)((function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}}))()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return null===(t=this.roomEncryptors[e])||void 0===t?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.exportRoomKeys((()=>!0));return JSON.parse(t)}))()}exportRoomKeysAsJson(){var e=this;return(0,i.A)((function*(){return yield e.olmMachine.exportRoomKeys((()=>!0))}))()}importRoomKeys(e,t){var r=this;return(0,i.A)((function*(){return yield r.backupManager.importRoomKeys(e,t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,i.A)((function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)}))()}userHasCrossSigningKeys(){var e=arguments,t=this;return(0,i.A)((function*(){var r,n=e.length>0&&void 0!==e[0]?e[0]:t.userId,i=e.length>1&&void 0!==e[1]&&e[1],s=yield t.olmMachine.trackedUsers();for(var o of s)if(n===o.toString()){r=o;break}if(void 0!==r){if(n===t.userId){var _=t.olmMachine.queryKeysForUsers([r.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(_)}var a=yield t.olmMachine.getIdentity(r);return null==a||a.free(),void 0!==a}if(i){var c,g=null===(c=(yield t.downloadDeviceList(new Set([n]))).master_keys)||void 0===c?void 0:c[n];return!!g&&Boolean(Object.values(g.keys)[0])}return!1}))()}getUserDeviceInfo(e){var t=arguments,r=this;return(0,i.A)((function*(){var n=t.length>1&&void 0!==t[1]&&t[1],i=new Map,s=yield r.getOlmMachineOrThrow().trackedUsers(),o=new Set;s.forEach((e=>o.add(e.toString())));var _=new Set;for(var a of e)o.has(a)?i.set(a,yield r.getUserDevices(a)):_.add(a);if(n&&_.size>=1){var c=yield r.downloadDeviceList(_);Object.entries(c.device_keys).forEach((e=>{var[t,r]=e;return i.set(t,function(e){return new Map(Object.entries(e).map((e=>{var[t,r]=e;return[t,O(r)]})))}(r))}))}return i}))()}getUserDevices(e){var t=this;return(0,i.A)((function*(){var r=new s.UserId(e),n=yield t.olmMachine.getUserDevices(r,1);try{var i=n.devices();try{return new Map(i.map((e=>[e.deviceId.toString(),D(e,r)])))}finally{i.forEach((e=>e.free()))}}finally{n.free()}}))()}downloadDeviceList(e){var t=this;return(0,i.A)((function*(){var r={device_keys:{}};return e.forEach((e=>r.device_keys[e]=[])),yield t.http.authedRequest(p.IT.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})}))()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,n=this;return(0,i.A)((function*(){var i=!(r.length>2&&void 0!==r[2])||r[2],o=yield n.olmMachine.getDevice(new s.UserId(e),new s.DeviceId(t));if(!o)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield o.setLocalTrust(i?s.LocalTrust.Verified:s.LocalTrust.Unset)}finally{o.free()}}))()}crossSignDevice(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getDevice(new s.UserId(t.userId),new s.DeviceId(e));if(!r)throw new Error("Unknown device ".concat(e));try{var n=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}finally{r.free()}}))()}getDeviceVerificationStatus(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getDevice(new s.UserId(e),new s.DeviceId(t));if(!n)return null;try{return new b.DeviceVerificationStatus({signedByOwner:n.isCrossSignedByOwner(),crossSigningVerified:n.isCrossSigningTrusted(),localVerified:n.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{n.free()}}))()}getUserVerificationStatus(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new s.UserId(e));if(void 0===r)return new b.UserVerificationStatus(!1,!1,!1);var n=r.isVerified(),i=r.wasPreviouslyVerified(),o=r instanceof s.OtherUserIdentity&&r.identityNeedsUserApproval();return r.free(),new b.UserVerificationStatus(n,i,!1,o)}))()}pinCurrentUserIdentity(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new s.UserId(e));if(void 0===r)throw new Error("Cannot pin identity of unknown user");if(r instanceof s.OwnUserIdentity)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()}))()}withdrawVerificationRequirement(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new s.UserId(e));if(void 0===r)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()}))()}isCrossSigningReady(){var e=this;return(0,i.A)((function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),n=Boolean(r.masterKey)&&Boolean(r.selfSigningKey)&&Boolean(r.userSigningKey),i=yield e.getOwnIdentity();return!(null==i||!i.isVerified())&&(n||t)}))()}getCrossSigningKeyId(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:b.CrossSigningKey.Master,n=yield t.olmMachine.getIdentity(new s.UserId(t.userId));if(!n)return null;try{var i,o=yield t.olmMachine.crossSigningStatus();if(!(o.hasMaster&&o.hasUserSigning&&o.hasSelfSigning))return null;if(!n.isVerified())return null;switch(r){case b.CrossSigningKey.Master:i=n.masterKey;break;case b.CrossSigningKey.SelfSigning:i=n.selfSigningKey;break;case b.CrossSigningKey.UserSigning:i=n.userSigningKey;break;default:return null}var _=JSON.parse(i);return Object.values(_.keys)[0]}finally{n.free()}}))()}bootstrapCrossSigning(e){var t=this;return(0,i.A)((function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)}))()}isSecretStorageReady(){var e=this;return(0,i.A)((function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"];return null!=(yield e.backupManager.getActiveBackupVersion())&&t.push("m.megolm_backup.v1"),V(e.secretStorage,t)}))()}bootstrapSecretStorage(){var e=arguments,t=this;return(0,i.A)((function*(){var{createSecretStorageKey:r,setupNewSecretStorage:n,setupNewKeyBackup:i}=e.length>0&&void 0!==e[0]?e[0]:{},s=n||!(yield t.secretStorageHasAESKey());if(s){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var o=yield r();if(!o)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(o)}var _=yield t.olmMachine.crossSigningStatus();if(_.hasMaster&&_.hasSelfSigning&&_.hasUserSigning&&(s||!(yield A(t.secretStorage)))){t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now.");var a=yield t.olmMachine.exportCrossSigningKeys();if(!a.masterKey)throw new Error("missing master key in cross signing private keys");if(!a.userSigningKey)throw new Error("missing user signing key in cross signing private keys");if(!a.self_signing_key)throw new Error("missing self signing key in cross signing private keys");yield t.secretStorage.store("m.cross_signing.master",a.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",a.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",a.self_signing_key)}i?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()}))()}saveBackupKeyToStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.backupManager.getServerBackupInfo();if(t&&t.version){var r=yield e.olmMachine.getBackupKeys();if(r.decryptionKey)if(X(r.decryptionKey,t)){var n=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",n)}else l.v.info("Not saving backup key to secret storage: decryption key does not match backup info");else l.v.info("Not saving backup key to secret storage: no backup key")}else l.v.info("Not saving backup key to secret storage: no backup info")}))()}addSecretStorageKeyToSecretStorage(e){var t=this;return(0,i.A)((function*(){var r,n,i,s,o=yield t.secretStorage.addKey(M.SECRET_STORAGE_ALGORITHM_V1_AES,{passphrase:null===(r=e.keyInfo)||void 0===r?void 0:r.passphrase,name:null===(n=e.keyInfo)||void 0===n?void 0:n.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(o.keyId),null===(i=(s=t.cryptoCallbacks).cacheSecretStorageKey)||void 0===i||i.call(s,o.keyId,o.keyInfo,e.privateKey)}))()}secretStorageHasAESKey(){var e=this;return(0,i.A)((function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===M.SECRET_STORAGE_ALGORITHM_V1_AES}))()}getCrossSigningStatus(){var e=this;return(0,i.A)((function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new s.UserId(e.userId)),r=Boolean(null==t?void 0:t.masterKey)&&Boolean(null==t?void 0:t.selfSigningKey)&&Boolean(null==t?void 0:t.userSigningKey);null==t||t.free();var n=yield A(e.secretStorage),i=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:n,privateKeysCachedLocally:{masterKey:Boolean(null==i?void 0:i.hasMaster),userSigningKey:Boolean(null==i?void 0:i.hasUserSigning),selfSigningKey:Boolean(null==i?void 0:i.hasSelfSigning)}}}))()}createRecoveryKeyFromPassphrase(e){var t=this;return(0,i.A)((function*(){if(e){var r=(0,Z.US)(32),n=yield(0,b.deriveRecoveryKeyFromPassphrase)(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:n,encodedPrivateKey:(0,b.encodeRecoveryKey)(n)}}var i=new Uint8Array(32);return globalThis.crypto.getRandomValues(i),{privateKey:i,encodedPrivateKey:(0,b.encodeRecoveryKey)(i)}}))()}getEncryptionInfoForEvent(e){var t=this;return(0,i.A)((function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)}))()}getVerificationRequestsToDeviceInProgress(e){return this.olmMachine.getVerificationRequests(new s.UserId(e)).filter((e=>void 0===e.roomId)).map((e=>new N(this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new s.UserId(t)).find((t=>{var r;return(null===(r=t.roomId)||void 0===r?void 0:r.toString())===e}));if(r)return new N(this.olmMachine,r,this.outgoingRequestProcessor,this._supportedVerificationMethods)}requestVerificationDM(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getIdentity(new s.UserId(e));if(!n)throw new Error("unknown userId ".concat(e));try{var i=r._supportedVerificationMethods.map((e=>W(e))),o=yield n.verificationRequestContent(i),_=yield r.sendVerificationRequestContent(t,o),a=yield n.requestVerification(new s.RoomId(t),new s.EventId(_),i);return new N(r.olmMachine,a,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}sendVerificationRequestContent(e,t){var r=this;return(0,i.A)((function*(){var n=(0,Z.US)(32),{event_id:i}=yield r.http.authedRequest(p.IT.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(n)),void 0,t,{prefix:""});return i}))()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=null!=e?e:ge}requestOwnUserVerification(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.getIdentity(new s.UserId(e.userId));if(void 0===t)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,n]=yield t.requestVerification(e._supportedVerificationMethods.map(W));return yield e.outgoingRequestProcessor.makeOutgoingRequest(n),new N(e.olmMachine,r,e.outgoingRequestProcessor,e._supportedVerificationMethods)}finally{t.free()}}))()}requestDeviceVerification(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getDevice(new s.UserId(e),new s.DeviceId(t));if(!n)throw new Error("Not a known device");try{var[i,o]=n.requestVerification(r._supportedVerificationMethods.map(W));return yield r.outgoingRequestProcessor.makeOutgoingRequest(o),new N(r.olmMachine,i,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}getSessionBackupPrivateKey(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?(0,v.y4)(t.decryptionKey.toBase64()):null}))()}storeSessionBackupPrivateKey(e,t){var r=this;return(0,i.A)((function*(){var n=(0,v.WG)(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(s.BackupDecryptionKey.fromBase64(n),t)}))()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var n=s.BackupDecryptionKey.fromBase64(t);if(!X(n,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(n,r.version)}))()}getActiveSessionBackupVersion(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.getActiveBackupVersion()}))()}getKeyBackupInfo(){var e=this;return(0,i.A)((function*(){return(yield e.backupManager.getServerBackupInfo())||null}))()}isKeyBackupTrusted(e){var t=this;return(0,i.A)((function*(){return yield t.backupManager.isKeyBackupTrusted(e)}))()}checkKeyBackupAndEnable(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)}))()}deleteKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){yield t.backupManager.deleteKeyBackupVersion(e)}))()}resetKeyBackup(){var e=this;return(0,i.A)((function*(){var t=yield e.backupManager.setupKeyBackup((t=>e.signObject(t)));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()}))()}signObject(e){var t=this;return(0,i.A)((function*(){var r=new Map(Object.entries(e.signatures||{})),n=e.unsigned;delete e.signatures,delete e.unsigned;var i=r.get(t.userId)||{},s=c.stringify(e),o=yield t.olmMachine.sign(s),_=JSON.parse(o.asJSON());r.set(t.userId,ce(ce({},i),_[t.userId])),void 0!==n&&(e.unsigned=n),e.signatures=Object.fromEntries(r.entries())}))()}restoreKeyBackupWithPassphrase(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.backupManager.getServerBackupInfo();if(null==n||!n.version)throw new Error("No backup info available");var i=yield(0,_e.c)(n.auth_data,e);return yield r.storeSessionBackupPrivateKey(i,n.version),r.restoreKeyBackup(t)}))()}restoreKeyBackup(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:n,backupVersion:i}=r;if(!n||!i)throw new Error("No decryption key found in crypto store");var s=(0,v.y4)(n.toBase64()),o=yield t.backupManager.requestKeyBackupVersion(i);if(!o)throw new Error("Backup version to restore ".concat(i," not found on server"));var _=yield t.getBackupDecryptor(o,s);try{var a;return null==e||null===(a=e.progressCallback)||void 0===a||a.call(e,{stage:"fetch"}),yield t.backupManager.restoreKeyBackup(i,_,e)}finally{_.free()}}))()}isDehydrationSupported(){var e=this;return(0,i.A)((function*(){return yield e.dehydratedDeviceManager.isSupported()}))()}startDehydration(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})}))()}importSecretsBundle(e){var t=this;return(0,i.A)((function*(){var r=s.SecretsBundle.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)}))()}exportSecretsBundle(){var e=this;return(0,i.A)((function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r}))()}encryptToDeviceMessages(e,t,r){var n=this;return(0,i.A)((function*(){var o=new l.T(n.logger,"encryptToDeviceMessages"),_=new Set(t.map((e=>{var{userId:t}=e;return t})));yield n.keyClaimManager.ensureSessionsForUsers(o,Array.from(_).map((e=>new s.UserId(e))));var a={batch:[],eventType:y.Bx.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var t=(0,i.A)((function*(t){var{userId:i,deviceId:o}=t,_=yield n.olmMachine.getDevice(new s.UserId(i),new s.DeviceId(o));if(_){var c=JSON.parse(yield _.encryptToDeviceEvent(e,r));a.batch.push({deviceId:o,userId:i,payload:c})}else n.logger.warn("encryptToDeviceMessages: unknown device ".concat(i,":").concat(o))}));return function(e){return t.apply(this,arguments)}}())),a}))()}resetEncryption(e){var t=this;return(0,i.A)((function*(){t.logger.debug("resetEncryption: resetting encryption"),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.secretStorage.setDefaultKeyId(null),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")}))()}receiveSyncChanges(e){var t=this;return(0,i.A)((function*(){var{events:r,oneTimeKeysCounts:n=new Map,unusedFallbackKeys:o,devices:_=new s.DeviceLists}=e,a=yield(0,h.NQ)(l.v,"receiveSyncChanges",(0,i.A)((function*(){return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",_,n,o)})));return JSON.parse(a)}))()}preprocessToDeviceMessages(e){var t=this;return(0,i.A)((function*(){var r=yield t.receiveSyncChanges({events:e});for(var n of r)if(n.type===y.Bx.KeyVerificationRequest){var i=n.sender,s=n.content.transaction_id;s&&i&&t.onIncomingKeyVerificationRequest(i,s)}return r}))()}processKeyCounts(e,t){var r=this;return(0,i.A)((function*(){var n=e&&new Map(Object.entries(e)),i=t&&new Set(t);void 0===n&&void 0===i||(yield r.receiveSyncChanges({oneTimeKeysCounts:n,unusedFallbackKeys:i}))}))()}processDeviceLists(e){var t=this;return(0,i.A)((function*(){var r,n,i=new s.DeviceLists(null===(r=e.changed)||void 0===r?void 0:r.map((e=>new s.UserId(e))),null===(n=e.left)||void 0===n?void 0:n.map((e=>new s.UserId(e))));yield t.receiveSyncChanges({devices:i})}))()}onCryptoEvent(e,t){var r=this;return(0,i.A)((function*(){var n=t.getContent(),i=new s.RoomSettings;if("m.megolm.v1.aes-sha2"===n.algorithm){i.algorithm=s.EncryptionAlgorithm.MegolmV1AesSha2;try{i.sessionRotationPeriodMs=n.rotation_period_ms,i.sessionRotationPeriodMessages=n.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new s.RoomId(e.roomId),i)}catch(t){return void r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(t))}var o=r.roomEncryptors[e.roomId];o?o.onCryptoEvent(n):r.roomEncryptors[e.roomId]=new f(r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,n)}else r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(n.algorithm))}))()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",e)}))}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new s.UserId(e),t);r?this.emit(b.CryptoEvent.VerificationRequestReceived,new N(this.olmMachine,r,this.outgoingRequestProcessor,this._supportedVerificationMethods)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}onRoomMembership(e,t,r){var n=this.roomEncryptors[e.getRoomId()];n&&n.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return(0,i.A)((function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()}))()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(0!==r.length){this.logger.debug("Retrying decryption on events:",r.map((e=>"".concat(e.getId()))));var n=function(e){e.attemptDecryption(t,{isRetry:!0}).catch((r=>{t.logger.info("Still unable to decrypt event ".concat(e.getId()," after receiving key"))}))};for(var i of r)n(i)}}}onRoomKeysWithheld(e){var t=this;return(0,i.A)((function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var n=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(0===n.length)return;for(var i of(t.logger.debug("Retrying decryption on events:",n.map((e=>"".concat(e.getId())))),n))i.attemptDecryption(t,{isRetry:!0}).catch((e=>{}))}}))()}onUserIdentityUpdated(e){var t=this;return(0,i.A)((function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(b.CryptoEvent.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(b.CryptoEvent.KeysChanged,{}),yield t.checkKeyBackupAndEnable())}))()}onDevicesUpdated(e){var t=this;return(0,i.A)((function*(){t.emit(b.CryptoEvent.WillUpdateDevices,e,!1),t.emit(b.CryptoEvent.DevicesUpdated,e,!1)}))()}handleSecretReceived(e,t){var r=this;return(0,i.A)((function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),"m.megolm_backup.v1"===e&&(yield r.backupManager.handleBackupSecretReceived(t))}))()}checkSecrets(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var n of r)if(yield t.handleSecretReceived(e,n))break;yield t.olmMachine.deleteSecretsFromInbox(e)}))()}onLiveEventFromSync(e){var t=this;return(0,i.A)((function*(){if(!e.isState()&&!e.getUnsigned().transaction_id){var r=function(){var r=(0,i.A)((function*(r){(function(e){switch(e.getType()){case y.Bx.KeyVerificationCancel:case y.Bx.KeyVerificationDone:case y.Bx.KeyVerificationMac:case y.Bx.KeyVerificationStart:case y.Bx.KeyVerificationKey:case y.Bx.KeyVerificationReady:case y.Bx.KeyVerificationAccept:return!0;case y.Bx.RoomMessage:return e.getContent().msgtype===y.Wr.KeyVerificationRequest;default:return!1}})(e)&&(yield t.onKeyVerificationEvent(r))}));return function(e){return r.apply(this,arguments)}}();if(e.isDecryptionFailure()||e.isEncrypted()){var n=setTimeout((()=>e.off(u.OQ.Decrypted,s)),3e5),s=(t,i)=>{i||(clearTimeout(n),e.off(u.OQ.Decrypted,s),r(t))};e.on(u.OQ.Decrypted,s)}else yield r(e)}}))()}onKeyVerificationEvent(e){var t=this;return(0,i.A)((function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new s.RoomId(r)),e.getType()===y.Bx.RoomMessage&&e.getContent().msgtype===y.Wr.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",e)}))}))()}getOwnIdentity(){var e=this;return(0,i.A)((function*(){return yield e.olmMachine.getIdentity(new s.UserId(e.userId))}))()}}class de{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,(0,n.A)(this,"eventsPendingKey",new h.kG((()=>new h.kG((()=>new Set)))))}attemptEventDecryption(e,t){var r=this;return(0,i.A)((function*(){var n;switch(r.addEventToPendingList(e),t.kind){case b.DeviceIsolationModeKind.AllDevicesIsolationMode:n=s.TrustRequirement.Untrusted;break;case b.DeviceIsolationModeKind.OnlySignedDevicesIsolationMode:n=s.TrustRequirement.CrossSignedOrLegacy}try{var i=yield r.olmMachine.decryptRoomEvent(le(e),new s.RoomId(e.getRoomId()),new s.DecryptionSettings(n));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(i.event),claimedEd25519Key:i.senderClaimedEd25519Key,senderCurve25519Key:i.senderCurve25519Key,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain}}catch(t){if(!(t instanceof s.MegolmDecryptionError))throw new d.O(b.DecryptionFailureCode.UNKNOWN_ERROR,"Unknown error");r.onMegolmDecryptionError(e,t,yield r.perSessionBackupDownloader.getServerBackupInfo())}}))()}onMegolmDecryptionError(e,t,r){var n=e.getWireContent(),i={sender_key:n.sender_key,session_id:n.session_id};if(t.code===s.DecryptionErrorCode.MissingRoomKey||t.code===s.DecryptionErrorCode.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),n.session_id);var o=e.getMembershipAtEvent();if(o&&o!==g.O.Join&&o!==g.O.Invite)throw new d.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",i);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw null===r?new d.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",i):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new d.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",i):new d.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",i)}if(t.maybe_withheld){var _="The sender has disabled encrypting to unverified devices."===t.maybe_withheld?b.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:b.DecryptionFailureCode.MEGOLM_KEY_WITHHELD;throw new d.O(_,t.maybe_withheld,i)}switch(t.code){case s.DecryptionErrorCode.MissingRoomKey:throw new d.O(b.DecryptionFailureCode.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",i);case s.DecryptionErrorCode.UnknownMessageIndex:throw new d.O(b.DecryptionFailureCode.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",i);case s.DecryptionErrorCode.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new d.O(b.DecryptionFailureCode.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case s.DecryptionErrorCode.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new d.O(b.DecryptionFailureCode.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case s.DecryptionErrorCode.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new d.O(b.DecryptionFailureCode.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new d.O(b.DecryptionFailureCode.UNKNOWN_ERROR,t.description,i)}}getEncryptionInfoForEvent(e){var t=this;return(0,i.A)((function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(null!==e.status)return{shieldColour:b.EventShieldColour.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(le(e),new s.RoomId(e.getRoomId()));return function(e,t){if(void 0===t)return null;var r,n,i=t.shieldState(!1);switch(i.color){case s.ShieldColor.Grey:r=b.EventShieldColour.GREY;break;case s.ShieldColor.None:r=b.EventShieldColour.NONE;break;default:r=b.EventShieldColour.RED}switch(i.code){case void 0:case null:n=null;break;case s.ShieldStateCode.AuthenticityNotGuaranteed:n=b.EventShieldReason.AUTHENTICITY_NOT_GUARANTEED;break;case s.ShieldStateCode.UnknownDevice:n=b.EventShieldReason.UNKNOWN_DEVICE;break;case s.ShieldStateCode.UnsignedDevice:n=b.EventShieldReason.UNSIGNED_DEVICE;break;case s.ShieldStateCode.UnverifiedIdentity:n=b.EventShieldReason.UNVERIFIED_IDENTITY;break;case s.ShieldStateCode.SentInClear:n=b.EventShieldReason.SENT_IN_CLEAR;break;case s.ShieldStateCode.VerificationViolation:n=b.EventShieldReason.VERIFICATION_VIOLATION}return{shieldColour:r,shieldReason:n}}(t.logger,r)}))()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var n=r.get(t);return n?[...n]:[]}addEventToPendingList(e){var t=e.getRoomId();t&&this.eventsPendingKey.getOrCreate(t).getOrCreate(e.getWireContent().session_id).add(e)}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var n=r.get(e.getWireContent().session_id);n&&(n.delete(e),0===n.size&&(r.delete(e.getWireContent().session_id),0===r.size&&this.eventsPendingKey.delete(t)))}}}}function le(e){return JSON.stringify({event_id:e.getId(),type:e.getWireType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getWireContent(),origin_server_ts:e.getTs()})}var pe=r(4303),ye=r(5530),we=r(5542);function he(){return he=(0,i.A)((function*(e){var t,{logger:r,legacyStore:n}=e;if(yield a(),new s.Tracing(s.LoggerLevel.Debug).turnOn(),yield n.containsData()){yield n.startup();var i=null;if(yield n.doTxn("readonly",[ye.y.STORE_ACCOUNT],(e=>{n.getAccount(e,(e=>{i=e}))})),i){var o=yield n.getMigrationState();if(!(o>=pe.Il.MEGOLM_SESSIONS_MIGRATED)){var _=yield function(e,t){return fe.apply(this,arguments)}(r,n),c=yield function(e,t){return ve.apply(this,arguments)}(r,n),g=1+_+c;r.info("Migrating data from legacy crypto store. ".concat(_," olm sessions and ").concat(c," megolm sessions to migrate."));var u=0;l(0);var d=(new TextEncoder).encode(e.legacyPickleKey);o===pe.Il.NOT_STARTED&&(r.info("Migrating data from legacy crypto store. Step 1: base data"),yield function(e,t,r,n,i,s,o){return be.apply(this,arguments)}(e.http,e.userId,e.deviceId,n,d,e.storeHandle,r),o=pe.Il.INITIAL_DATA_MIGRATED,yield n.setMigrationState(o)),l(1),o===pe.Il.INITIAL_DATA_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(_," sessions to migrate).")),yield function(e,t,r,n,i){return me.apply(this,arguments)}(r,n,d,e.storeHandle,l),o=pe.Il.OLM_SESSIONS_MIGRATED,yield n.setMigrationState(o)),o===pe.Il.OLM_SESSIONS_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(c," sessions to migrate).")),yield function(e,t,r,n,i){return ke.apply(this,arguments)}(r,n,d,e.storeHandle,l),o=pe.Il.MEGOLM_SESSIONS_MIGRATED,yield n.setMigrationState(o)),null===(t=e.legacyMigrationProgressListener)||void 0===t||t.call(e,-1,-1),r.info("Migration from legacy crypto store complete")}}else r.debug("Legacy crypto store is not set up (no account found). Not migrating.")}function l(t){var r;u+=t,null===(r=e.legacyMigrationProgressListener)||void 0===r||r.call(e,u,g)}})),he.apply(this,arguments)}function be(){return(be=(0,i.A)((function*(e,t,r,n,i,o,_){var a=new s.BaseMigrationData;a.userId=new s.UserId(t),a.deviceId=new s.DeviceId(r),yield n.doTxn("readonly",[ye.y.STORE_ACCOUNT],(e=>n.getAccount(e,(e=>{a.pickledAccount=null!=e?e:""}))));var c=yield Re(n,i,"m.megolm_backup.v1");if(c){for(var g=!1,u=null;!g;)try{u=yield H(e),g=!0}catch(e){_.info("Failed to get backup version during migration, retrying in 2 seconds",e),yield(0,h.yy)(2e3)}if(u&&"m.megolm_backup.v1.curve25519-aes-sha2"==u.algorithm)try{var d,l=s.BackupDecryptionKey.fromBase64(c),p=null===(d=u.auth_data)||void 0===d?void 0:d.public_key;l.megolmV1PublicKey.publicKeyBase64==p?(a.backupVersion=u.version,a.backupRecoveryKey=c):_.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(l.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(p))}catch(e){_.warn("Failed to check if the backup key to migrate matches the active backup version",e)}}a.privateCrossSigningMasterKey=yield Re(n,i,"master"),a.privateCrossSigningSelfSigningKey=yield Re(n,i,"self_signing"),a.privateCrossSigningUserSigningKey=yield Re(n,i,"user_signing"),yield s.Migration.migrateBaseData(a,i,o)}))).apply(this,arguments)}function fe(){return(fe=(0,i.A)((function*(e,t){var r;return e.debug("Counting olm sessions to be migrated"),yield t.doTxn("readonly",[ye.y.STORE_SESSIONS],(e=>t.countEndToEndSessions(e,(e=>r=e)))),r}))).apply(this,arguments)}function ve(){return(ve=(0,i.A)((function*(e,t){return e.debug("Counting megolm sessions to be migrated"),yield t.countEndToEndInboundGroupSessions()}))).apply(this,arguments)}function me(){return(me=(0,i.A)((function*(e,t,r,n,i){for(;;){var o=yield t.getEndToEndSessionsBatch();if(null===o)return;e.debug("Migrating batch of ".concat(o.length," olm sessions"));var _=[];for(var a of o){var c=new s.PickledSession;c.senderKey=a.deviceKey,c.pickle=a.session,c.lastUseTime=c.creationTime=new Date(a.lastReceivedMessageTs),_.push(c)}yield s.Migration.migrateOlmSessions(_,r,n),yield t.deleteEndToEndSessionsBatch(o),i(o.length)}}))).apply(this,arguments)}function ke(){return(ke=(0,i.A)((function*(e,t,r,n,i){for(;;){var o=yield t.getEndToEndInboundGroupSessionsBatch();if(null===o)return;e.debug("Migrating batch of ".concat(o.length," megolm sessions"));var _=[];for(var a of o){var c,g=a.sessionData,u=new s.PickledInboundGroupSession;u.pickle=g.session,u.roomId=new s.RoomId(g.room_id),u.senderKey=a.senderKey,u.senderSigningKey=null===(c=g.keysClaimed)||void 0===c?void 0:c.ed25519,u.backedUp=!a.needsBackup,u.imported=!0===g.untrusted,_.push(u)}yield s.Migration.migrateMegolmSessions(_,r,n),yield t.deleteEndToEndInboundGroupSessionsBatch(o),i(o.length)}}))).apply(this,arguments)}function Se(){return(Se=(0,i.A)((function*(e){var{logger:t,legacyStore:r,olmMachine:n}=e;if((yield r.containsData())&&!((yield r.getMigrationState())>=pe.Il.ROOM_SETTINGS_MIGRATED)){var i={};for(var[o,_]of(yield r.doTxn("readwrite",[ye.y.STORE_ROOMS],(e=>{r.getEndToEndRooms(e,(e=>{i=e}))})),t.debug("Migrating ".concat(Object.keys(i).length," sets of room settings")),Object.entries(i)))try{var a=new s.RoomSettings;if("m.megolm.v1.aes-sha2"!==_.algorithm){t.warn("Room ".concat(o,": ignoring room with invalid algorithm ").concat(_.algorithm));continue}a.algorithm=s.EncryptionAlgorithm.MegolmV1AesSha2,a.sessionRotationPeriodMs=_.rotation_period_ms,a.sessionRotationPeriodMessages=_.rotation_period_msgs,yield n.setRoomSettings(new s.RoomId(o),a)}catch(e){t.warn("Room ".concat(o,": ignoring settings ").concat(JSON.stringify(_)," which caused error ").concat(e))}t.debug("Completed room settings migration"),yield r.setMigrationState(pe.Il.ROOM_SETTINGS_MIGRATED)}}))).apply(this,arguments)}function Re(e,t,r){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,i.A)((function*(e,t,r){var n=yield new Promise((t=>{e.doTxn("readonly",[ye.y.STORE_ACCOUNT],(n=>{e.getSecretStorePrivateKey(n,t,r)}))}));return n&&n.ciphertext&&n.iv&&n.mac?yield(0,we.A)(n,t,r):n instanceof Uint8Array?(0,v.WG)(n):void 0}))).apply(this,arguments)}function Ke(){return Ke=(0,i.A)((function*(e){var{legacyCryptoStore:t,rustCrypto:r,logger:n}=e,i=yield r.getOwnIdentity();if(i&&!i.isVerified()){var s=yield function(e){return Ce.apply(this,arguments)}(t);if(s){var o=JSON.parse(i.masterKey);if(o.keys&&0!==Object.keys(o.keys).length){var _=Object.values(o.keys)[0];_&&_==s&&(n.info("Post Migration: Migrating legacy trusted MSK: ".concat(s," to locally verified.")),yield i.verify())}else n.error("Post Migration | Unexpected error: no master key in the rust session.")}}})),Ke.apply(this,arguments)}function Ce(){return(Ce=(0,i.A)((function*(e){var t=null;return yield e.doTxn("readonly","account",(r=>{e.getCrossSigningKeys(r,(e=>{var r=null==e?void 0:e.master;r&&0!=Object.keys(r.keys).length&&(t=Object.values(r.keys)[0])}))})),t}))).apply(this,arguments)}function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){return Oe.apply(this,arguments)}function Oe(){return Oe=(0,i.A)((function*(e){var t,{logger:r}=e;r.debug("Initialising Rust crypto-sdk WASM artifact"),yield a(),new s.Tracing(s.LoggerLevel.Debug).turnOn(),r.debug("Opening Rust CryptoStore"),t=e.storePrefix?e.storeKey?yield s.StoreHandle.openWithKey(e.storePrefix,e.storeKey):yield s.StoreHandle.open(e.storePrefix,e.storePassphrase):yield s.StoreHandle.open(),e.legacyCryptoStore&&(yield function(e){return he.apply(this,arguments)}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({legacyStore:e.legacyCryptoStore,storeHandle:t},e)));var i=yield function(e,t,r,n,i,s,o,_){return Me.apply(this,arguments)}(r,e.http,e.userId,e.deviceId,e.secretStorage,e.cryptoCallbacks,t,e.legacyCryptoStore);return t.free(),r.debug("Completed rust crypto-sdk setup"),i})),Oe.apply(this,arguments)}function Me(){return Me=(0,i.A)((function*(e,t,r,n,i,o,_,a){e.debug("Init OlmMachine");var c=yield s.OlmMachine.initFromStore(new s.UserId(r),new s.DeviceId(n),_);a&&(yield function(e){return Se.apply(this,arguments)}({logger:e,legacyStore:a,olmMachine:c})),c.roomKeyRequestsEnabled=!1;var g=new ue(e,c,t,r,n,i,o);if(yield c.registerRoomKeyUpdatedCallback((e=>g.onRoomKeysUpdated(e))),yield c.registerRoomKeysWithheldCallback((e=>g.onRoomKeysWithheld(e))),yield c.registerUserIdentityUpdatedCallback((e=>g.onUserIdentityUpdated(e))),yield c.registerDevicesUpdatedCallback((e=>g.onDevicesUpdated(e))),g.checkSecrets("m.megolm_backup.v1"),yield c.registerReceiveSecretCallback(((e,t)=>g.checkSecrets(e))),yield c.outgoingRequests(),a&&(yield a.containsData())&&(yield a.getMigrationState())<pe.Il.INITIAL_OWN_KEY_QUERY_DONE){e.debug("Performing initial key query after migration");for(var u=!1;!u;)try{yield g.userHasCrossSigningKeys(r),u=!0}catch(t){e.error("Failed to check for cross-signing keys after migration, retrying",t)}yield function(e){return Ke.apply(this,arguments)}({legacyCryptoStore:a,rustCrypto:g,logger:e}),yield a.setMigrationState(pe.Il.INITIAL_OWN_KEY_QUERY_DONE)}return g})),Me.apply(this,arguments)}}}]);