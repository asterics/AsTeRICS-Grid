!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.GridList=i()}(this,function(){function l(t,i){for(var s in this._options=i,this.defaults)this._options.hasOwnProperty(s)||(this._options[s]=this.defaults[s]);this.items=t,this._adjustSizeOfItems(),this.generateGrid()}l.cloneItems=function(t,i){var s,e;for(void 0===i&&(i=[]),s=0;s<t.length;s++)for(e in i[s]||(i[s]={}),t[s])i[s][e]=t[s][e];return i},l.prototype={defaults:{lanes:5,direction:"horizontal"},toString:function(){var t,i,s,e=this.grid.length,o="\n #|",n="\n --";for(i=0;i<e;i++)o+=" "+this._padNumber(i," "),n+="---";for(o+=n,i=0;i<this._options.lanes;i++)for(o+="\n"+this._padNumber(i," ")+"|",s=0;s<e;s++)o+=" ",o+=(t=this.grid[s][i])?this._padNumber(this.items.indexOf(t),"0"):"--";return o+="\n"},generateGrid:function(){var t;for(this._resetGrid(),t=0;t<this.items.length;t++)this._markItemPositionToGrid(this.items[t])},fillGaps:function(){this._pullItemsToLeft()},resolveCollisions:function(i){var t=this.items.filter(function(t){return t.$element.children()[0].id==i})[0];t&&this._resolveCollisions(t)},resizeGrid:function(t){var i=0,s=this._options.lanes;this._options.lanes=t,this._adjustSizeOfItems();for(var e=!1,o=0;o<this.items.length;o++){var n=(h=this._getItemPosition(this.items[o])).y+h.h;n<=s&&t<n&&(e=!0)}if(e&&t<s){this._sortItemsByPosition(),this._resetGrid();for(o=0;o<this.items.length;o++){var r=this.items[o],h=this._getItemPosition(r);this._updateItemPosition(r,this.findPositionForItem(r,{x:i,y:0})),i=Math.max(i,h.x)}this._pullItemsToLeft()}},findPositionForItem:function(t,i,s){var e,o,n;for(e=i.x;e<this.grid.length;e++)if(void 0!==s){if(n=[e,s],this._itemFitsAtPosition(t,n))return n}else for(o=i.y;o<this._options.lanes;o++)if(n=[e,o],this._itemFitsAtPosition(t,n))return n;var r=this.grid.length,h=0;return void 0!==s&&this._itemFitsAtPosition(t,[r,s])&&(h=s),[r,h]},moveItemToPosition:function(t,i){var s=this._getItemPosition({x:i[0],y:i[1],w:t.w,h:t.h});return this._updateItemPosition(t,[s.x,s.y]),this._resolveCollisions(t)},resizeItem:function(t,i){var s=i.w||t.w,e=i.h||t.h;return this._updateItemSize(t,s,e),this._resolveCollisions(t)},getChangedItems:function(t,i){for(var s=[],e=0;e<t.length;e++){var o=this._getItemByAttribute(i,t[e][i]);o.x===t[e].x&&o.y===t[e].y&&o.w===t[e].w&&o.h===t[e].h||s.push(o)}return s},_sortItemsByPosition:function(){this.items.sort(function(t,i){var s=this._getItemPosition(t),e=this._getItemPosition(i);return s.x!=e.x?s.x-e.x:s.y!=e.y?s.y-e.y:0}.bind(this))},_adjustSizeOfItems:function(){for(var t=0;t<this.items.length;t++){var i=this.items[t];i.h>this._options.lanes&&(i.h=this._options.lanes),void 0===i.autoSize&&(i.autoSize=0===i.w||0===i.h),i.autoSize&&("horizontal"===this._options.direction?i.h=this._options.lanes:i.w=this._options.lanes)}},_resetGrid:function(){this.grid=[]},_itemFitsAtPosition:function(t,i){var s,e,o=this._getItemPosition(t);if(i[0]<0||i[1]<0)return!1;if(i[1]+o.h>this._options.lanes)return!1;for(s=i[0];s<i[0]+o.w;s++){var n=this.grid[s];if(n)for(e=i[1];e<i[1]+o.h;e++)if(n[e]&&n[e]!==t)return!1}return!0},_updateItemPosition:function(t,i){null!==t.x&&null!==t.y&&this._deleteItemPositionFromGrid(t),this._setItemPosition(t,i),this._markItemPositionToGrid(t)},_updateItemSize:function(t,i,s){null!==t.x&&null!==t.y&&this._deleteItemPositionFromGrid(t),t.w=i,t.h=s,this._markItemPositionToGrid(t)},_markItemPositionToGrid:function(t){var i,s,e=this._getItemPosition(t);for(this._ensureColumns(e.x+e.w),i=e.x;i<e.x+e.w;i++)for(s=e.y;s<e.y+e.h;s++)this.grid[i][s]=t},_deleteItemPositionFromGrid:function(t){var i,s,e=this._getItemPosition(t);for(i=e.x;i<e.x+e.w;i++)if(this.grid[i])for(s=e.y;s<e.y+e.h;s++)this.grid[i][s]==t&&(this.grid[i][s]=null)},_ensureColumns:function(t){var i;for(i=0;i<t;i++)this.grid[i]||this.grid.push(new s(this._options.lanes))},_getItemsCollidingWithItem:function(t){for(var i=[],s=0;s<this.items.length;s++)t!=this.items[s]&&this._itemsAreColliding(t,this.items[s])&&i.push(s);return i},_itemsAreColliding:function(t,i){var s=this._getItemPosition(t),e=this._getItemPosition(i);return!(e.x>=s.x+s.w||e.x+e.w<=s.x||e.y>=s.y+s.h||e.y+e.h<=s.y)},_resolveCollisions:function(t){var i=this._tryToResolveCollisionsLocally(t);return i||this._pullItemsToLeft(t),i},_tryToResolveCollisionsLocally:function(t){var i=this._getItemsCollidingWithItem(t);if(!i.length)return!0;var s,e,o,n,r=new l([],this._options);l.cloneItems(this.items,r.items),r.generateGrid();for(var h=0;h<i.length;h++){var m=r.items[i[h]],f=this._getItemPosition(m),u=this._getItemPosition(t);if(s=[u.x-f.w,f.y],e=[u.x+u.w,f.y],o=[f.x,u.y-f.h],n=[f.x,u.y+u.h],r._itemFitsAtPosition(m,s))r._updateItemPosition(m,s);else if(r._itemFitsAtPosition(m,o))r._updateItemPosition(m,o);else if(r._itemFitsAtPosition(m,n))r._updateItemPosition(m,n);else{if(!r._itemFitsAtPosition(m,e))return!1;r._updateItemPosition(m,e)}}return l.cloneItems(r.items,this.items),this.generateGrid(),!0},_pullItemsToLeft:function(t){if(this._sortItemsByPosition(),this._resetGrid(),t){var i=this._getItemPosition(t);this._updateItemPosition(t,[i.x,i.y])}for(var s=0;s<this.items.length;s++){var e=this.items[s],o=this._getItemPosition(e);if(!t||e!==t){var n=this._findLeftMostPositionForItem(e,t),r=this.findPositionForItem(e,{x:n,y:0},o.y);this._updateItemPosition(e,r)}}},_findLeftMostPositionForItem:function(t,i){for(var s=0,e=this._getItemPosition(t),o=0;o<this.grid.length;o++)for(var n=e.y;n<e.y+e.h;n++){var r=this.grid[o][n];if(r){var h=this._getItemPosition(r);this.items.indexOf(r)<this.items.indexOf(t)&&r!==i&&(s=h.x+h.w)}}return s},_getItemByAttribute:function(t,i){for(var s=0;s<this.items.length;s++)if(this.items[s][t]===i)return this.items[s];return null},_padNumber:function(t,i){return 10<=t?t:i+t},_getItemPosition:function(t){return"horizontal"===this._options.direction?t:{x:t.y,y:t.x,w:t.h,h:t.w}},_setItemPosition:function(t,i){"horizontal"===this._options.direction?(t.x=i[0],t.y=i[1]):(t.x=i[1],t.y=i[0])}};var s=function(t){for(var i=0;i<t;i++)this.push(null)};return s.prototype=[],l});